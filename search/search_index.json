{
    "docs": [
        {
            "location": "/", 
            "text": "Welcome to MkDocs\n\n\nFor full documentation visit \nmkdocs.org\n.\n\n\nCommands\n\n\n\n\nmkdocs new [dir-name]\n - Create a new project.\n\n\nmkdocs serve\n - Start the live-reloading docs server.\n\n\nmkdocs build\n - Build the documentation site.\n\n\nmkdocs help\n - Print this help message.\n\n\n\n\nProject layout\n\n\nmkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.", 
            "title": "\u4e00. \u4ecb\u7ecd"
        }, 
        {
            "location": "/#welcome-to-mkdocs", 
            "text": "For full documentation visit  mkdocs.org .", 
            "title": "Welcome to MkDocs"
        }, 
        {
            "location": "/#commands", 
            "text": "mkdocs new [dir-name]  - Create a new project.  mkdocs serve  - Start the live-reloading docs server.  mkdocs build  - Build the documentation site.  mkdocs help  - Print this help message.", 
            "title": "Commands"
        }, 
        {
            "location": "/#project-layout", 
            "text": "mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.", 
            "title": "Project layout"
        }, 
        {
            "location": "/install/", 
            "text": "", 
            "title": "\u4e8c. \u5b89\u88c5"
        }, 
        {
            "location": "/ovs/", 
            "text": "\u540c\u5bbf\u4e3b\uff0c\u540c\u5b50\u7f51\u76842\u53f0VM\u4e92\u901a\n\n\n\n\n# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br br-int\n\n# \u7528veth\u6a21\u62dfvm\uff0c\u5c06veth\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\novs-vsctl add-port br-int poi-vm1\novs-vsctl add-port br-int poi-vm2\n\n\n\n\n\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u5b50\u7f51\u4e4b\u95f4\u9694\u79bb\uff08\u5206\u522b\u6865\u63a5\uff09\n\n\n\n\n# \u5efa\u7acb\u6865\u63a5\uff0cbiv-100\u662f\u5b50\u7f511\uff0cbiv-200\u662f\u5b50\u7f512\novs-vsctl add-br biv-100\novs-vsctl add-br biv-200\n\n# \u7528veth\u6a21\u62dfvm\uff0c2\u4e2avm\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u5206\u522b\u52a0\u51652\u4e2a\u6865\u63a5\novs-vsctl add-port biv-100 poi-vm1\novs-vsctl add-port biv-200 poi-vm2\n\n\n\n\n\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u5b50\u7f51\u4e4b\u95f4\u9694\u79bb\uff08\u6253tag\uff09\n\n\n\n\n# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br br-int\n\n# \u7528veth\u6a21\u62dfvm\uff0c2\u4e2avm\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\uff0c\u540c\u65f6\u6253tag\novs-vsctl add-port br-int poi-vm1 -- set port poi-vm1 tag=100\novs-vsctl add-port br-int poi-vm2 -- set port poi-vm2 tag=200\n\n\n\n\n\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u6865\u63a5\u4e4b\u95f4\u4e8c\u5c42\u4e92\u901a\n\n\n\n\n# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br biv-100\novs-vsctl add-br biv-200\n\n# \u521b\u5efapatch port\uff0c2\u7aef\u5206\u522b\u6865\u63a5\u5230biv-100\u548cbiv-200\novs-vsctl add-port biv-100 patch-to-200 -- set interface patch-to-200 type=patch -- set interface patch-to-200 options:peer=patch-to-100\novs-vsctl add-port biv-200 patch-to-100 -- set interface patch-to-100 type=patch -- set interface patch-to-100 options:peer=patch-to-200\n\n# \u7528veth\u6a21\u62dfvm\uff0cvm\u5728\u5bbf\u4e3b\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\novs-vsctl add-port biv-100 poi-vm1\novs-vsctl add-port biv-200 poi-vm2\n\n\n\n\n\u4e0d\u540c\u5bbf\u4e3b\uff0c\u540c\u5b50\u7f51\u4e92\u901a\u8fd9\u4e48\u505a\u4f1a\u73af\u8def\n\n\n\n\n\n\n\u8fd9\u6837\u770b\u4e0a\u53bb\u597d\u50cf\u6ca1\u5565\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u4e2a\u56fe\u53ef\u4ee5\u753b\u6210\u8fd9\u6837\uff1a\n\n\n\n\n\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u73af\u8def\uff0c\u5982\u679c\u5bbf\u4e3b\u673a\u5c312\u53f0\u8fd8\u4e0d\u4f1a\u73af\u8def\uff0c\u53ea\u8981\u8fbe\u52303\u53f0\u5c31\u4f1a\u5f00\u59cb\u73af\u8def\n\n\n\u6ce8\u610f\uff1a\u6211\u4eec\u5f53\u524d\u7528linux bridge\u6ca1\u6709\u73af\u8def\u662f\u56e0\u4e3a\u65e0\u8bba\u662f\u591a\u64advtep\u8fd8\u662f\u5355\u64advtep\uff0c\u4e00\u4e2a\u6865\u63a5\u7f51\u5361\u90fd\u53ea\u6865\u63a5\u4e00\u4e2avtep\uff0c\u800c\u5e7f\u64ad\u5305\uff08\u6216\u8005\u53eb\u6cdb\u6d2a\uff09\u7684\u7279\u6027\u662f\u6570\u636e\u5305\u4ece\u975e\u5165\u53e3\u7684\u6240\u6709\u7aef\u53e3\u6cdb\u6d2a\u51fa\u53bb\uff0c\u5373\u5982\u679c\u4e00\u4e2alinux bridge\u6865\u63a52\u4e2avtep\uff0c\u4e5f\u662f\u4f1a\u9020\u6210\u73af\u8def\u7684\n\n\n\u5176\u5b9eopenstack\u7684\u7f51\u7edc\u67b6\u6784\u56fe\u753b\u51fa\u6765\u770b\u4e5f\u662f\u6709\u73af\u8def\u7684\uff1a\n\n\n\n\n\u90a3\u4e48\u4e3a\u4ec0\u4e48\u6ca1\u6709\u73af\u8def\u5462\uff0c\u662f\u56e0\u4e3a\u5982\u679cbr-tun\u53ea\u662f\u4e2a\u7b80\u5355\u7684switch/hub\u529f\u80fd\uff0c\u90a3\u4e48\u662f\u4f1a\u73af\u8def\u7684\uff0cvtep\u6536\u5230\u6570\u636e\u5305\u540e\u4f1a\u4ecebr-tun\u7684\u53e6\u4e00\u4e2avtep\u6cdb\u6d2a\u51fa\u53bb\u3002\u4f46br-tun\u662fopenflow\u63a7\u5236\u7684\uff0c\u5176\u4e2d2\u6761\u89c4\u5219\u8d77\u4e86\u5173\u952e\u4f5c\u7528\uff1a\n\n\n\n\n\n\nbr-tun\u4ecevtep\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u5c06vni\u53bb\u6389\uff0c\u52a0\u4e0avlan\u5934\uff0c\u8fd9\u8fd8\u4e0d\u662f\u5173\u952e\uff0c\u5173\u952e\u662f\u7b2c2\u70b9\n\n\n\n\n\n\n\u7136\u540e\u5c06\u6570\u636e\u5305\u4ecepatch-int\u7aef\u53e3\u53d1\u51fa\uff0c\u5373\u8fd9\u4e2a\u6570\u636e\u5305\u53ea\u53d1\u5230br-int\u800c\u4e0d\u4f1a\u4ea4\u5230\u53e6\u4e00\u4e2avtep\u4e0a\uff0c\u56e0\u6b64\u4e0d\u4f1a\u4ea7\u751f\u73af\u8def\n\n\n\n\n\n\niptables/ebtables\u5bf9ovs port\u4e0d\u8d77\u4f5c\u7528\n\n\n\n\n\n\n\n\n\u7ecf\u6d4b\u8bd5\uff0c\u4f7f\u7528iptables\u548cebtables\u5bf9ovs\u7aef\u53e3\u4e0d\u8d77\u4efb\u4f55\u4f5c\u7528\uff0c\u53ea\u5bf9linux bridge\u7684\u7aef\u53e3\u8d77\u4f5c\u7528\n\n\n\n\n\n\n\blinux bridge\u548covs\u901a\u8fc7veth\u6216ovs patch-port\u76f8\u8fde\u7684\u8bdd\uff0ciptables\u3001ebtables\u5bf9linux bridge\u8fd9\u7aef\u7684\u9650\u5236\u662f\u6709\u6548\u7684", 
            "title": "\u4e09. ovs"
        }, 
        {
            "location": "/ovs/#2vm", 
            "text": "# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br br-int\n\n# \u7528veth\u6a21\u62dfvm\uff0c\u5c06veth\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\novs-vsctl add-port br-int poi-vm1\novs-vsctl add-port br-int poi-vm2", 
            "title": "\u540c\u5bbf\u4e3b\uff0c\u540c\u5b50\u7f51\u76842\u53f0VM\u4e92\u901a"
        }, 
        {
            "location": "/ovs/#_1", 
            "text": "# \u5efa\u7acb\u6865\u63a5\uff0cbiv-100\u662f\u5b50\u7f511\uff0cbiv-200\u662f\u5b50\u7f512\novs-vsctl add-br biv-100\novs-vsctl add-br biv-200\n\n# \u7528veth\u6a21\u62dfvm\uff0c2\u4e2avm\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u5206\u522b\u52a0\u51652\u4e2a\u6865\u63a5\novs-vsctl add-port biv-100 poi-vm1\novs-vsctl add-port biv-200 poi-vm2", 
            "title": "\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u5b50\u7f51\u4e4b\u95f4\u9694\u79bb\uff08\u5206\u522b\u6865\u63a5\uff09"
        }, 
        {
            "location": "/ovs/#tag", 
            "text": "# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br br-int\n\n# \u7528veth\u6a21\u62dfvm\uff0c2\u4e2avm\u5728\u5bbf\u4e3b\u4e0a\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\uff0c\u540c\u65f6\u6253tag\novs-vsctl add-port br-int poi-vm1 -- set port poi-vm1 tag=100\novs-vsctl add-port br-int poi-vm2 -- set port poi-vm2 tag=200", 
            "title": "\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u5b50\u7f51\u4e4b\u95f4\u9694\u79bb\uff08\u6253tag\uff09"
        }, 
        {
            "location": "/ovs/#_2", 
            "text": "# \u5efa\u7acb\u6865\u63a5\novs-vsctl add-br biv-100\novs-vsctl add-br biv-200\n\n# \u521b\u5efapatch port\uff0c2\u7aef\u5206\u522b\u6865\u63a5\u5230biv-100\u548cbiv-200\novs-vsctl add-port biv-100 patch-to-200 -- set interface patch-to-200 type=patch -- set interface patch-to-200 options:peer=patch-to-100\novs-vsctl add-port biv-200 patch-to-100 -- set interface patch-to-100 type=patch -- set interface patch-to-100 options:peer=patch-to-200\n\n# \u7528veth\u6a21\u62dfvm\uff0cvm\u5728\u5bbf\u4e3b\u7684\u4e00\u7aef\u52a0\u5165\u6865\u63a5\novs-vsctl add-port biv-100 poi-vm1\novs-vsctl add-port biv-200 poi-vm2", 
            "title": "\u540c\u5bbf\u4e3b\uff0c\u4e0d\u540c\u6865\u63a5\u4e4b\u95f4\u4e8c\u5c42\u4e92\u901a"
        }, 
        {
            "location": "/ovs/#_3", 
            "text": "\u8fd9\u6837\u770b\u4e0a\u53bb\u597d\u50cf\u6ca1\u5565\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u4e2a\u56fe\u53ef\u4ee5\u753b\u6210\u8fd9\u6837\uff1a   \u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u73af\u8def\uff0c\u5982\u679c\u5bbf\u4e3b\u673a\u5c312\u53f0\u8fd8\u4e0d\u4f1a\u73af\u8def\uff0c\u53ea\u8981\u8fbe\u52303\u53f0\u5c31\u4f1a\u5f00\u59cb\u73af\u8def  \u6ce8\u610f\uff1a\u6211\u4eec\u5f53\u524d\u7528linux bridge\u6ca1\u6709\u73af\u8def\u662f\u56e0\u4e3a\u65e0\u8bba\u662f\u591a\u64advtep\u8fd8\u662f\u5355\u64advtep\uff0c\u4e00\u4e2a\u6865\u63a5\u7f51\u5361\u90fd\u53ea\u6865\u63a5\u4e00\u4e2avtep\uff0c\u800c\u5e7f\u64ad\u5305\uff08\u6216\u8005\u53eb\u6cdb\u6d2a\uff09\u7684\u7279\u6027\u662f\u6570\u636e\u5305\u4ece\u975e\u5165\u53e3\u7684\u6240\u6709\u7aef\u53e3\u6cdb\u6d2a\u51fa\u53bb\uff0c\u5373\u5982\u679c\u4e00\u4e2alinux bridge\u6865\u63a52\u4e2avtep\uff0c\u4e5f\u662f\u4f1a\u9020\u6210\u73af\u8def\u7684  \u5176\u5b9eopenstack\u7684\u7f51\u7edc\u67b6\u6784\u56fe\u753b\u51fa\u6765\u770b\u4e5f\u662f\u6709\u73af\u8def\u7684\uff1a   \u90a3\u4e48\u4e3a\u4ec0\u4e48\u6ca1\u6709\u73af\u8def\u5462\uff0c\u662f\u56e0\u4e3a\u5982\u679cbr-tun\u53ea\u662f\u4e2a\u7b80\u5355\u7684switch/hub\u529f\u80fd\uff0c\u90a3\u4e48\u662f\u4f1a\u73af\u8def\u7684\uff0cvtep\u6536\u5230\u6570\u636e\u5305\u540e\u4f1a\u4ecebr-tun\u7684\u53e6\u4e00\u4e2avtep\u6cdb\u6d2a\u51fa\u53bb\u3002\u4f46br-tun\u662fopenflow\u63a7\u5236\u7684\uff0c\u5176\u4e2d2\u6761\u89c4\u5219\u8d77\u4e86\u5173\u952e\u4f5c\u7528\uff1a    br-tun\u4ecevtep\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u5c06vni\u53bb\u6389\uff0c\u52a0\u4e0avlan\u5934\uff0c\u8fd9\u8fd8\u4e0d\u662f\u5173\u952e\uff0c\u5173\u952e\u662f\u7b2c2\u70b9    \u7136\u540e\u5c06\u6570\u636e\u5305\u4ecepatch-int\u7aef\u53e3\u53d1\u51fa\uff0c\u5373\u8fd9\u4e2a\u6570\u636e\u5305\u53ea\u53d1\u5230br-int\u800c\u4e0d\u4f1a\u4ea4\u5230\u53e6\u4e00\u4e2avtep\u4e0a\uff0c\u56e0\u6b64\u4e0d\u4f1a\u4ea7\u751f\u73af\u8def", 
            "title": "\u4e0d\u540c\u5bbf\u4e3b\uff0c\u540c\u5b50\u7f51\u4e92\u901a\u8fd9\u4e48\u505a\u4f1a\u73af\u8def"
        }, 
        {
            "location": "/ovs/#iptablesebtablesovs-port", 
            "text": "\u7ecf\u6d4b\u8bd5\uff0c\u4f7f\u7528iptables\u548cebtables\u5bf9ovs\u7aef\u53e3\u4e0d\u8d77\u4efb\u4f55\u4f5c\u7528\uff0c\u53ea\u5bf9linux bridge\u7684\u7aef\u53e3\u8d77\u4f5c\u7528    \blinux bridge\u548covs\u901a\u8fc7veth\u6216ovs patch-port\u76f8\u8fde\u7684\u8bdd\uff0ciptables\u3001ebtables\u5bf9linux bridge\u8fd9\u7aef\u7684\u9650\u5236\u662f\u6709\u6548\u7684", 
            "title": "iptables/ebtables\u5bf9ovs port\u4e0d\u8d77\u4f5c\u7528"
        }, 
        {
            "location": "/openflow/", 
            "text": "\u67e5\u770b\n\n\n\n\n# \u67e5\u770bopenflow\u7aef\u53e3\u4fe1\u606f\novs-ofctl show ovs-switch\n\n# \u67e5\u770bopenflow\u7aef\u53e3\u7f16\u53f7\novs-vsctl get interface p0 ofport\n\n# \u67e5\u770bdatapath\novs-dpctl show\n\n# \u67e5\u770b\u6d41\u8868\novs-ofctl dump-flows ovs-switch\n\n\n\n\n\u6d41\u8868\u64cd\u4f5c\n\n\n\n\n\u9ed8\u8ba4\u89c4\u5219\n\n\n\u6bcf\u4e2a\u4ea4\u6362\u673a\u521b\u5efa\u4e4b\u540e\u9ed8\u8ba4\u90fd\u6709\u4e00\u6761\u6d41\u8868\u89c4\u5219\uff0c\u7528\u4e8e\u5141\u8bb8\u6240\u6709\u6d41\u91cf\u901a\u8fc7\n\n\nNXST_FLOW reply (xid=0x4):\n\n cookie=0x0, duration=1588.919s, table=0, n_packets=50, n_bytes=3260, idle_age=0, priority=0 actions=NORMAL\n\n\n\n\n\u52a0\u4eae\u8fd9\u6761\u5c31\u662f\u9ed8\u8ba4\u7684\u6d41\u8868\uff0c\u5982\u679c\u8fd9\u6761\u5220\u6389\uff0c\u90a3\u4e48\u5f53\u5176\u4ed6\u6761\u76ee\u90fd\u6ca1\u5339\u914d\u5230\u7684\u65f6\u5019\uff0c\u6570\u636e\u5305\u5c31\u4f1a\u88ab\u4e22\u5f03\n\n\n\u6dfb\u52a0\u89c4\u5219\n\n\n# \u5c4f\u853d\u6240\u6709\u8fdb\u5165 OVS \u7684\u4ee5\u592a\u7f51\u5e7f\u64ad\u6570\u636e\u5305\novs-ofctl add-flow ovs-switch \ntable=0, dl_src=01:00:00:00:00:00/01:00:00:00:00:00, actions=drop\n\n\n\n\n\n\u6d41\u8868\u53c2\u6570\u8be6\u89e3\n\n\novs-ofctl dump-flows ovs-switch\n\n\n\n\n\u8f93\u51fa\n\n\nNXST_FLOW reply (xid=0x4):\ncookie=0x0, duration=7.672s, table=0, n_packets=0, n_bytes=0, idle_age=7, priority=0 actions=NORMAL\n\n\n\n\n\n\n\n\ncookie: \u4e0d\u4e86\u89e3\uff0c\u5b98\u65b9manpage\u89e3\u91ca\u5982\u4e0b\n\n\nmanpage\nAn opaque identifier called a cookie can be used as a handle to identify a set of flows:\n\ncookie=value\n    A cookie can be associated with a flow using the add-flow, add-flows, and mod-flows commands.  value can be any 64-bit number and need not be unique among flows. If this field is omitted, a default cookie value of 0 is used.\n\ncookie=value/mask\n    When using NXM, the cookie can be used as a handle for querying, modifying, and deleting flows. value and mask may be supplied for the del-flows, mod-flows, dump-flows, and dump-aggregate commands to limit matching cookies. A 1-bit in mask indicates that the corresponding bit in cookie must match exactly, and a 0-bit wildcards that bit. A mask of -1 may be used to exactly match a cookie.\n\n    The  mod-flows  command can update the cookies of flows that match a cookie by specifying the cookie field twice (once with a mask for matching and once without to indicate the new value):\n\n    ovs-ofctl mod-flows br0 cookie=1,actions=normal\n        Change all flows\n cookies to 1 and change their actions to normal.\n\n    ovs-ofctl mod-flows br0 cookie=1/-1,cookie=2,actions=normal\n        Update cookies with a value of 1 to 2 and change their actions to normal.\n\n    The ability to match on cookies was added in Open vSwitch 1.5.0.\n\n\n\n\n\n\n\nduration: \u8be5\u6761\u76ee\u521b\u5efa\u591a\u4e45\u4e86\n\n\n\n\n\n\ntable: \u8be5\u6761\u76ee\u6240\u5c5etable\n\n\n\n\n\n\nn_packets: \u5339\u914d\u4e86\u591a\u5c11\u4e2a\u5305\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684\n\n\n\n\n\n\nn_bytes: \u5339\u914d\u7684\u6240\u6709\u5305\u7684\u5927\u5c0f\u603b\u548c\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684\n\n\n\n\n\n\nidle_age: \u8be5\u6761\u76ee\u591a\u4e45\u6ca1\u88ab\u5339\u914d\u4e86\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684\n\n\n\n\n\n\npriority: \u8868\u5185\u6761\u76ee\u4f18\u5148\u7ea7\uff0c0-65535\uff0c\u6570\u5b57\u8d8a\u8fc7\u8d8a\u4f18\u5148\uff0c\u4e0d\u6307\u5b9a\u4f18\u5148\u7ea7\u5219\u4e3a32768\uff0c\u76f8\u540c\u4f18\u5148\u7ea7\u7684\u8bdd\uff0c\u5148\u63d2\u5165\u7684\u4f18\u5148\uff08dump-flows\u7ed3\u679c\u4e2d\u9760\u4e0a\u7684\u4f18\u5148\uff09\n\n\n\n\n\n\nactions: \u5339\u914d\u4e4b\u540e\u7684\u64cd\u4f5c\n\n\n\n\n\n\n\u5b9e\u9a8c\n\n\n\n\n\u4f7f\u7528openflow\u8f6c\u53d1\u5305\u5230\u591a\u4e2a\u7aef\u53e3\n\n\n\u8f6c\u5230\u4efb\u4f55\u7aef\u53e3\u7684\u65b9\u6cd5\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5305\u62ecveth\u548cvtep\u3002\u6548\u679c\u7b49\u540c\u4e8e\u7528linux bridge\u65f6\u5019\u7684bridge fdb append\n\n\n# \u5148\u6e05\u7a7a\u9ed8\u8ba4\u6761\u76ee\uff0c\u4ee5\u514d\u5bfc\u81f4\u73af\u8def\uff0c\u4e5f\u662f\u4e3a\u4e86\u66f4\u4e86\u89e3\u6570\u636e\u5305\novs-ofctl del-flows br-tun\n\n# \b\u8f6c\u5230openflow\u7aef\u53e31\u30012\u30013\u30014\novs-ofctl add-flow br-tun \ntable=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=output:1,2,3,4\n\n\n\n\n\n\u4e0a\u9762\u7684\n\n\nactions=output:1,2,3,4\n\n\n\n\n\u7b49\u540c\u4e8e(ovs-ofctl\u5c31\u53ef\u4ee5\u770b\u5230\u81ea\u52a8\u7ffb\u8bd1\u6210\u5982\u4e0b)\n\n\nactions=output:1,output:2,output:3,output:4\n\n\n\n\n\u6d41\u8868\u5339\u914d\u987a\u5e8f\n\n\n\n\ntable -\n flow priority\n\n\n\u5373\u5148\u4ecetable\u5f00\u59cb\uff0c\u4ece0\u5230254\uff0c\u5728table\u91cc\u6709\u591a\u4e2aopenflow\u6761\u76ee\uff0c\u6839\u636e\u4f18\u5148\u7ea7priority\u6700\u9ad8\u7684\u4f18\u5148\u5339\u914d", 
            "title": "\u56db. openflow"
        }, 
        {
            "location": "/openflow/#_1", 
            "text": "# \u67e5\u770bopenflow\u7aef\u53e3\u4fe1\u606f\novs-ofctl show ovs-switch\n\n# \u67e5\u770bopenflow\u7aef\u53e3\u7f16\u53f7\novs-vsctl get interface p0 ofport\n\n# \u67e5\u770bdatapath\novs-dpctl show\n\n# \u67e5\u770b\u6d41\u8868\novs-ofctl dump-flows ovs-switch", 
            "title": "\u67e5\u770b"
        }, 
        {
            "location": "/openflow/#_2", 
            "text": "", 
            "title": "\u6d41\u8868\u64cd\u4f5c"
        }, 
        {
            "location": "/openflow/#_3", 
            "text": "\u6bcf\u4e2a\u4ea4\u6362\u673a\u521b\u5efa\u4e4b\u540e\u9ed8\u8ba4\u90fd\u6709\u4e00\u6761\u6d41\u8868\u89c4\u5219\uff0c\u7528\u4e8e\u5141\u8bb8\u6240\u6709\u6d41\u91cf\u901a\u8fc7  NXST_FLOW reply (xid=0x4):  cookie=0x0, duration=1588.919s, table=0, n_packets=50, n_bytes=3260, idle_age=0, priority=0 actions=NORMAL  \u52a0\u4eae\u8fd9\u6761\u5c31\u662f\u9ed8\u8ba4\u7684\u6d41\u8868\uff0c\u5982\u679c\u8fd9\u6761\u5220\u6389\uff0c\u90a3\u4e48\u5f53\u5176\u4ed6\u6761\u76ee\u90fd\u6ca1\u5339\u914d\u5230\u7684\u65f6\u5019\uff0c\u6570\u636e\u5305\u5c31\u4f1a\u88ab\u4e22\u5f03", 
            "title": "\u9ed8\u8ba4\u89c4\u5219"
        }, 
        {
            "location": "/openflow/#_4", 
            "text": "# \u5c4f\u853d\u6240\u6709\u8fdb\u5165 OVS \u7684\u4ee5\u592a\u7f51\u5e7f\u64ad\u6570\u636e\u5305\novs-ofctl add-flow ovs-switch  table=0, dl_src=01:00:00:00:00:00/01:00:00:00:00:00, actions=drop", 
            "title": "\u6dfb\u52a0\u89c4\u5219"
        }, 
        {
            "location": "/openflow/#_5", 
            "text": "ovs-ofctl dump-flows ovs-switch  \u8f93\u51fa  NXST_FLOW reply (xid=0x4):\ncookie=0x0, duration=7.672s, table=0, n_packets=0, n_bytes=0, idle_age=7, priority=0 actions=NORMAL    cookie: \u4e0d\u4e86\u89e3\uff0c\u5b98\u65b9manpage\u89e3\u91ca\u5982\u4e0b  manpage An opaque identifier called a cookie can be used as a handle to identify a set of flows:\n\ncookie=value\n    A cookie can be associated with a flow using the add-flow, add-flows, and mod-flows commands.  value can be any 64-bit number and need not be unique among flows. If this field is omitted, a default cookie value of 0 is used.\n\ncookie=value/mask\n    When using NXM, the cookie can be used as a handle for querying, modifying, and deleting flows. value and mask may be supplied for the del-flows, mod-flows, dump-flows, and dump-aggregate commands to limit matching cookies. A 1-bit in mask indicates that the corresponding bit in cookie must match exactly, and a 0-bit wildcards that bit. A mask of -1 may be used to exactly match a cookie.\n\n    The  mod-flows  command can update the cookies of flows that match a cookie by specifying the cookie field twice (once with a mask for matching and once without to indicate the new value):\n\n    ovs-ofctl mod-flows br0 cookie=1,actions=normal\n        Change all flows  cookies to 1 and change their actions to normal.\n\n    ovs-ofctl mod-flows br0 cookie=1/-1,cookie=2,actions=normal\n        Update cookies with a value of 1 to 2 and change their actions to normal.\n\n    The ability to match on cookies was added in Open vSwitch 1.5.0.    duration: \u8be5\u6761\u76ee\u521b\u5efa\u591a\u4e45\u4e86    table: \u8be5\u6761\u76ee\u6240\u5c5etable    n_packets: \u5339\u914d\u4e86\u591a\u5c11\u4e2a\u5305\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684    n_bytes: \u5339\u914d\u7684\u6240\u6709\u5305\u7684\u5927\u5c0f\u603b\u548c\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684    idle_age: \u8be5\u6761\u76ee\u591a\u4e45\u6ca1\u88ab\u5339\u914d\u4e86\uff0c\u6ce8\u610f\u662f\u5339\u914d\uff0c\u5373\u5982\u679c\u8be5\u6761\u76ee\u6709\u88ab\u67e5\u8be2\u8fc7\uff0c\u4f46\u662f\u6ca1\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u503c\u662f\u4e0d\u4f1a\u589e\u52a0\u7684    priority: \u8868\u5185\u6761\u76ee\u4f18\u5148\u7ea7\uff0c0-65535\uff0c\u6570\u5b57\u8d8a\u8fc7\u8d8a\u4f18\u5148\uff0c\u4e0d\u6307\u5b9a\u4f18\u5148\u7ea7\u5219\u4e3a32768\uff0c\u76f8\u540c\u4f18\u5148\u7ea7\u7684\u8bdd\uff0c\u5148\u63d2\u5165\u7684\u4f18\u5148\uff08dump-flows\u7ed3\u679c\u4e2d\u9760\u4e0a\u7684\u4f18\u5148\uff09    actions: \u5339\u914d\u4e4b\u540e\u7684\u64cd\u4f5c", 
            "title": "\u6d41\u8868\u53c2\u6570\u8be6\u89e3"
        }, 
        {
            "location": "/openflow/#_6", 
            "text": "", 
            "title": "\u5b9e\u9a8c"
        }, 
        {
            "location": "/openflow/#openflow", 
            "text": "\u8f6c\u5230\u4efb\u4f55\u7aef\u53e3\u7684\u65b9\u6cd5\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5305\u62ecveth\u548cvtep\u3002\u6548\u679c\u7b49\u540c\u4e8e\u7528linux bridge\u65f6\u5019\u7684bridge fdb append  # \u5148\u6e05\u7a7a\u9ed8\u8ba4\u6761\u76ee\uff0c\u4ee5\u514d\u5bfc\u81f4\u73af\u8def\uff0c\u4e5f\u662f\u4e3a\u4e86\u66f4\u4e86\u89e3\u6570\u636e\u5305\novs-ofctl del-flows br-tun\n\n# \b\u8f6c\u5230openflow\u7aef\u53e31\u30012\u30013\u30014\novs-ofctl add-flow br-tun  table=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=output:1,2,3,4   \u4e0a\u9762\u7684  actions=output:1,2,3,4  \u7b49\u540c\u4e8e(ovs-ofctl\u5c31\u53ef\u4ee5\u770b\u5230\u81ea\u52a8\u7ffb\u8bd1\u6210\u5982\u4e0b)  actions=output:1,output:2,output:3,output:4", 
            "title": "\u4f7f\u7528openflow\u8f6c\u53d1\u5305\u5230\u591a\u4e2a\u7aef\u53e3"
        }, 
        {
            "location": "/openflow/#_7", 
            "text": "table -  flow priority  \u5373\u5148\u4ecetable\u5f00\u59cb\uff0c\u4ece0\u5230254\uff0c\u5728table\u91cc\u6709\u591a\u4e2aopenflow\u6761\u76ee\uff0c\u6839\u636e\u4f18\u5148\u7ea7priority\u6700\u9ad8\u7684\u4f18\u5148\u5339\u914d", 
            "title": "\u6d41\u8868\u5339\u914d\u987a\u5e8f"
        }, 
        {
            "location": "/test/test1/", 
            "text": "\u67b6\u6784\u56fe\n\n\n\n\n\u7269\u7406\u56fe\n\n\n\n\n\u903b\u8f91\u56fe\n\n\n\n\n\u6d41\u8868\u56fe\n\n\n\n\nNode 1\n\n\n\n\n\n\n\n\novs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5220\u9664ovs\u6865\u63a5\n\novs-vsctl del-br br-int\n\n\n# \u521b\u5efaovs\u6865\u63a5\n\novs-vsctl add-br br-int\n\n\n# \u6e05\u7a7a\u6d41\u8868\n\novs-ofctl del-flows br-int\n\n\n# \u521b\u5efavtep\n\novs-vsctl add-port br-int vtep137 -- \nset\n interface vtep137 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.137 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\novs-vsctl add-port br-int vtep138 -- \nset\n interface vtep138 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.138 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\n\n\n\n\n\n\n\nbridge.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nbrctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link \nset\n biv-1001100 up\n\nbrctl addbr biv-1234567\nip link \nset\n biv-1234567 up\n\n\n\n\n\n\n\nbr-to-ovs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100 \ntype\n veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link \nset\n vib-1001100 up\nip link \nset\n vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567 \ntype\n veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link \nset\n vib-1234567 up\nip link \nset\n vio-1234567 up\novs-vsctl add-port br-int vio-1234567\n\n\n\n\n\n\n\nopenflow.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a\n\n\n# 1. \u4ece\u88680\u5f00\u59cb\n\n\n# 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55\n\n\n# 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3\n\n\n# 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406\n\n\n\n# \u83b7\u5f97openflow\u7aef\u53e3\n\n\nvio1001100_ofport\n=\n`\novs-vsctl get interface vio-1001100 ofport\n`\n\n\nvio1234567_ofport\n=\n`\novs-vsctl get interface vio-1234567 ofport\n`\n\n\nvtep137_ofport\n=\n`\novs-vsctl get interface vtep137 ofport\n`\n\n\nvtep138_ofport\n=\n`\novs-vsctl get interface vtep138 ofport\n`\n\n\n\n\n# table 0\n\n\n## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=goto_table:2\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=goto_table:2\n\n\n\n## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep137_ofport\n}\n, actions=goto_table:10\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep138_ofport\n}\n, actions=goto_table:10\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=0, priority=0, actions=drop\n\n\n\n\n# table 2\n\n\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n\n## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=2, priority=0, actions=drop\n\n\n\n\n# table 10\n\n\n## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n\n\n## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n\n\n##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n\n\n##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n\n\n##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1001100_ofport\n}\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1234567_ofport\n}\n\n\n\n## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\n\novs-ofctl add-flow br-int \ntable=10, priority=0, actions=drop\n\n\n\n\n# table 20\n\n\n## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n\n\n## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=20, priority=0, actions=goto_table:22\n\n\n\n\n# table 22\n\n\n## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=set_tunnel:1001100,output:\n${\nvtep137_ofport\n}\n,\n${\nvtep138_ofport\n}\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=set_tunnel:1234567,output:\n${\nvtep137_ofport\n}\n,\n${\nvtep138_ofport\n}\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=22, priority=0, actions=drop\n\n\n\n\n\n\n\n\nvm.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip netns del s1-vm1\nip netns del s1-vm2\nip netns del s2-vm1\nip netns del s2-vm2\n\nip netns add s1-vm1\nip link add poi-s1-vm1 \ntype\n veth peer name pii-s1-vm1\nip link \nset\n pii-s1-vm1 netns s1-vm1\nip netns \nexec\n s1-vm1 ip link \nset\n lo up\nip netns \nexec\n s1-vm1 ip addr add \n192\n.168.1.1/24 dev pii-s1-vm1\nip netns \nexec\n s1-vm1 ip link \nset\n pii-s1-vm1 up\nip netns \nexec\n s1-vm1 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm1 up\nbrctl addif biv-1001100 poi-s1-vm1\n\nip netns add s1-vm2\nip link add poi-s1-vm2 \ntype\n veth peer name pii-s1-vm2\nip link \nset\n pii-s1-vm2 netns s1-vm2\nip netns \nexec\n s1-vm2 ip link \nset\n lo up\nip netns \nexec\n s1-vm2 ip addr add \n192\n.168.1.2/24 dev pii-s1-vm2\nip netns \nexec\n s1-vm2 ip link \nset\n pii-s1-vm2 up\nip netns \nexec\n s1-vm2 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm2 up\nbrctl addif biv-1001100 poi-s1-vm2\n\nip netns add s2-vm1\nip link add poi-s2-vm1 \ntype\n veth peer name pii-s2-vm1\nip link \nset\n pii-s2-vm1 netns s2-vm1\nip netns \nexec\n s2-vm1 ip link \nset\n lo up\nip netns \nexec\n s2-vm1 ip addr add \n192\n.168.2.1/24 dev pii-s2-vm1\nip netns \nexec\n s2-vm1 ip link \nset\n pii-s2-vm1 up\nip netns \nexec\n s2-vm1 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm1 up\nbrctl addif biv-1234567 poi-s2-vm1\n\nip netns add s2-vm2\nip link add poi-s2-vm2 \ntype\n veth peer name pii-s2-vm2\nip link \nset\n pii-s2-vm2 netns s2-vm2\nip netns \nexec\n s2-vm2 ip link \nset\n lo up\nip netns \nexec\n s2-vm2 ip addr add \n192\n.168.2.2/24 dev pii-s2-vm2\nip netns \nexec\n s2-vm2 ip link \nset\n pii-s2-vm2 up\nip netns \nexec\n s2-vm2 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm2 up\nbrctl addif biv-1234567 poi-s2-vm2\n\n\n\n\n\n\n\nNode 2\n\n\n\n\n\n\n\n\novs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5220\u9664ovs\u6865\u63a5\n\novs-vsctl del-br br-int\n\n\n# \u521b\u5efaovs\u6865\u63a5\n\novs-vsctl add-br br-int\n\n\n# \u6e05\u7a7a\u6d41\u8868\n\novs-ofctl del-flows br-int\n\n\n# \u521b\u5efavtep\n\novs-vsctl add-port br-int vtep136 -- \nset\n interface vtep136 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.136 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\novs-vsctl add-port br-int vtep138 -- \nset\n interface vtep138 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.138 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\n\n\n\n\n\n\n\nbridge.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nbrctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link \nset\n biv-1001100 up\n\nbrctl addbr biv-1234567\nip link \nset\n biv-1234567 up\n\n\n\n\n\n\n\nbr-to-ovs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100 \ntype\n veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link \nset\n vib-1001100 up\nip link \nset\n vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567 \ntype\n veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link \nset\n vib-1234567 up\nip link \nset\n vio-1234567 up\novs-vsctl add-port br-int vio-1234567\n\n\n\n\n\n\n\nopenflow.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a\n\n\n# 1. \u4ece\u88680\u5f00\u59cb\n\n\n# 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55\n\n\n# 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3\n\n\n# 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406\n\n\n\n# \u83b7\u5f97openflow\u7aef\u53e3\n\n\nvio1001100_ofport\n=\n`\novs-vsctl get interface vio-1001100 ofport\n`\n\n\nvio1234567_ofport\n=\n`\novs-vsctl get interface vio-1234567 ofport\n`\n\n\nvtep136_ofport\n=\n`\novs-vsctl get interface vtep136 ofport\n`\n\n\nvtep138_ofport\n=\n`\novs-vsctl get interface vtep138 ofport\n`\n\n\n\n\n# table 0\n\n\n## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=goto_table:2\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=goto_table:2\n\n\n\n## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep136_ofport\n}\n, actions=goto_table:10\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep138_ofport\n}\n, actions=goto_table:10\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=0, priority=0, actions=drop\n\n\n\n\n# table 2\n\n\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n\n## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=2, priority=0, actions=drop\n\n\n\n\n# table 10\n\n\n## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n\n\n## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n\n\n##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n\n\n##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n\n\n##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1001100_ofport\n}\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1234567_ofport\n}\n\n\n\n## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\n\novs-ofctl add-flow br-int \ntable=10, priority=0, actions=drop\n\n\n\n\n# table 20\n\n\n## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n\n\n## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=20, priority=0, actions=goto_table:22\n\n\n\n\n# table 22\n\n\n## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=set_tunnel:1001100,output:\n${\nvtep136_ofport\n}\n,\n${\nvtep138_ofport\n}\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=set_tunnel:1234567,output:\n${\nvtep136_ofport\n}\n,\n${\nvtep138_ofport\n}\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=22, priority=0, actions=drop\n\n\n\n\n\n\n\n\nvm.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip netns del s1-vm3\nip netns del s1-vm4\nip netns del s2-vm3\nip netns del s2-vm4\n\nip netns add s1-vm3\nip link add poi-s1-vm3 \ntype\n veth peer name pii-s1-vm3\nip link \nset\n pii-s1-vm3 netns s1-vm3\nip netns \nexec\n s1-vm3 ip link \nset\n lo up\nip netns \nexec\n s1-vm3 ip addr add \n192\n.168.1.3/24 dev pii-s1-vm3\nip netns \nexec\n s1-vm3 ip link \nset\n pii-s1-vm3 up\nip netns \nexec\n s1-vm3 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm3 up\nbrctl addif biv-1001100 poi-s1-vm3\n\nip netns add s1-vm4\nip link add poi-s1-vm4 \ntype\n veth peer name pii-s1-vm4\nip link \nset\n pii-s1-vm4 netns s1-vm4\nip netns \nexec\n s1-vm4 ip link \nset\n lo up\nip netns \nexec\n s1-vm4 ip addr add \n192\n.168.1.4/24 dev pii-s1-vm4\nip netns \nexec\n s1-vm4 ip link \nset\n pii-s1-vm4 up\nip netns \nexec\n s1-vm4 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm4 up\nbrctl addif biv-1001100 poi-s1-vm4\n\nip netns add s2-vm3\nip link add poi-s2-vm3 \ntype\n veth peer name pii-s2-vm3\nip link \nset\n pii-s2-vm3 netns s2-vm3\nip netns \nexec\n s2-vm3 ip link \nset\n lo up\nip netns \nexec\n s2-vm3 ip addr add \n192\n.168.2.3/24 dev pii-s2-vm3\nip netns \nexec\n s2-vm3 ip link \nset\n pii-s2-vm3 up\nip netns \nexec\n s2-vm3 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm3 up\nbrctl addif biv-1234567 poi-s2-vm3\n\nip netns add s2-vm4\nip link add poi-s2-vm4 \ntype\n veth peer name pii-s2-vm4\nip link \nset\n pii-s2-vm4 netns s2-vm4\nip netns \nexec\n s2-vm4 ip link \nset\n lo up\nip netns \nexec\n s2-vm4 ip addr add \n192\n.168.2.4/24 dev pii-s2-vm4\nip netns \nexec\n s2-vm4 ip link \nset\n pii-s2-vm4 up\nip netns \nexec\n s2-vm4 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm4 up\nbrctl addif biv-1234567 poi-s2-vm4\n\n\n\n\n\n\n\nNode 3\n\n\n\n\n\n\n\n\novs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5220\u9664ovs\u6865\u63a5\n\novs-vsctl del-br br-int\n\n\n# \u521b\u5efaovs\u6865\u63a5\n\novs-vsctl add-br br-int\n\n\n# \u6e05\u7a7a\u6d41\u8868\n\novs-ofctl del-flows br-int\n\n\n# \u521b\u5efavtep\n\novs-vsctl add-port br-int vtep137 -- \nset\n interface vtep137 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.137 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\novs-vsctl add-port br-int vtep136 -- \nset\n interface vtep136 \ntype\n=\nvxlan options:remote_ip\n=\n172\n.16.1.136 options:ttl\n=\n64\n options:in_key\n=\nflow options:out_key\n=\nflow\n\n\n\n\n\n\n\nbridge.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nbrctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link \nset\n biv-1001100 up\n\nbrctl addbr biv-1234567\nip link \nset\n biv-1234567 up\n\n\n\n\n\n\n\nbr-to-ovs.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100 \ntype\n veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link \nset\n vib-1001100 up\nip link \nset\n vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567 \ntype\n veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link \nset\n vib-1234567 up\nip link \nset\n vio-1234567 up\novs-vsctl add-port br-int vio-1234567\n\n\n\n\n\n\n\nopenflow.sh\n\n\n\u70b9\u51fb\u6253\u5f00\n# \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a\n\n\n# 1. \u4ece\u88680\u5f00\u59cb\n\n\n# 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55\n\n\n# 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3\n\n\n# 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406\n\n\n\n# \u83b7\u5f97openflow\u7aef\u53e3\n\n\nvio1001100_ofport\n=\n`\novs-vsctl get interface vio-1001100 ofport\n`\n\n\nvio1234567_ofport\n=\n`\novs-vsctl get interface vio-1234567 ofport\n`\n\n\nvtep137_ofport\n=\n`\novs-vsctl get interface vtep137 ofport\n`\n\n\nvtep136_ofport\n=\n`\novs-vsctl get interface vtep136 ofport\n`\n\n\n\n\n# table 0\n\n\n## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=goto_table:2\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=goto_table:2\n\n\n\n## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep137_ofport\n}\n actions=goto_table:10\n\novs-ofctl add-flow br-int \ntable=0, priority=1, in_port=\n${\nvtep136_ofport\n}\n actions=goto_table:10\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=0, priority=0, actions=drop\n\n\n\n\n# table 2\n\n\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00 actions=goto_table:20\n\n\n\n## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=goto_table:22\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=2, priority=0, actions=drop\n\n\n\n\n# table 10\n\n\n## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n\n\n## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n\n\n##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n\n\n##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n\n\n##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1001100_ofport\n}\n\novs-ofctl add-flow br-int \ntable=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:\n${\nvio1234567_ofport\n}\n\n\n\n## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\n\novs-ofctl add-flow br-int \ntable=10, priority=0, actions=drop\n\n\n\n\n# table 20\n\n\n## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n\n\n## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\n\novs-ofctl add-flow br-int \ntable=20, priority=0, actions=goto_table:22\n\n\n\n\n# table 22\n\n\n## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1001100_ofport\n}\n, actions=set_tunnel:1001100,output:\n${\nvtep137_ofport\n}\n,\n${\nvtep136_ofport\n}\n\novs-ofctl add-flow br-int \ntable=22, priority=1, in_port=\n${\nvio1234567_ofport\n}\n, actions=set_tunnel:1234567,output:\n${\nvtep137_ofport\n}\n,\n${\nvtep136_ofport\n}\n\n\n\n## \u5176\u4f59DROP\n\novs-ofctl add-flow br-int \ntable=22, priority=0, actions=drop\n\n\n\n\n\n\n\n\nvm.sh\n\n\n\u70b9\u51fb\u6253\u5f00\nip netns del s1-vm5\nip netns del s1-vm6\nip netns del s2-vm5\nip netns del s2-vm6\n\nip netns add s1-vm5\nip link add poi-s1-vm5 \ntype\n veth peer name pii-s1-vm5\nip link \nset\n pii-s1-vm5 netns s1-vm5\nip netns \nexec\n s1-vm5 ip link \nset\n lo up\nip netns \nexec\n s1-vm5 ip addr add \n192\n.168.1.5/24 dev pii-s1-vm5\nip netns \nexec\n s1-vm5 ip link \nset\n pii-s1-vm5 up\nip netns \nexec\n s1-vm5 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm5 up\nbrctl addif biv-1001100 poi-s1-vm5\n\nip netns add s1-vm6\nip link add poi-s1-vm6 \ntype\n veth peer name pii-s1-vm6\nip link \nset\n pii-s1-vm6 netns s1-vm6\nip netns \nexec\n s1-vm6 ip link \nset\n lo up\nip netns \nexec\n s1-vm6 ip addr add \n192\n.168.1.6/24 dev pii-s1-vm6\nip netns \nexec\n s1-vm6 ip link \nset\n pii-s1-vm6 up\nip netns \nexec\n s1-vm6 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s1-vm6 up\nbrctl addif biv-1001100 poi-s1-vm6\n\nip netns add s2-vm5\nip link add poi-s2-vm5 \ntype\n veth peer name pii-s2-vm5\nip link \nset\n pii-s2-vm5 netns s2-vm5\nip netns \nexec\n s2-vm5 ip link \nset\n lo up\nip netns \nexec\n s2-vm5 ip addr add \n192\n.168.2.5/24 dev pii-s2-vm5\nip netns \nexec\n s2-vm5 ip link \nset\n pii-s2-vm5 up\nip netns \nexec\n s2-vm5 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm5 up\nbrctl addif biv-1234567 poi-s2-vm5\n\nip netns add s2-vm6\nip link add poi-s2-vm6 \ntype\n veth peer name pii-s2-vm6\nip link \nset\n pii-s2-vm6 netns s2-vm6\nip netns \nexec\n s2-vm6 ip link \nset\n lo up\nip netns \nexec\n s2-vm6 ip addr add \n192\n.168.2.6/24 dev pii-s2-vm6\nip netns \nexec\n s2-vm6 ip link \nset\n pii-s2-vm6 up\nip netns \nexec\n s2-vm6 \necho\n \n1\n \n /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link \nset\n poi-s2-vm6 up\nbrctl addif biv-1234567 poi-s2-vm6", 
            "title": "1. \u5b9e\u9a8c1"
        }, 
        {
            "location": "/test/test1/#_1", 
            "text": "\u7269\u7406\u56fe   \u903b\u8f91\u56fe   \u6d41\u8868\u56fe", 
            "title": "\u67b6\u6784\u56fe"
        }, 
        {
            "location": "/test/test1/#node-1", 
            "text": "ovs.sh  \u70b9\u51fb\u6253\u5f00 # \u5220\u9664ovs\u6865\u63a5 \novs-vsctl del-br br-int # \u521b\u5efaovs\u6865\u63a5 \novs-vsctl add-br br-int # \u6e05\u7a7a\u6d41\u8868 \novs-ofctl del-flows br-int # \u521b\u5efavtep \novs-vsctl add-port br-int vtep137 --  set  interface vtep137  type = vxlan options:remote_ip = 172 .16.1.137 options:ttl = 64  options:in_key = flow options:out_key = flow\novs-vsctl add-port br-int vtep138 --  set  interface vtep138  type = vxlan options:remote_ip = 172 .16.1.138 options:ttl = 64  options:in_key = flow options:out_key = flow    bridge.sh  \u70b9\u51fb\u6253\u5f00 brctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link  set  biv-1001100 up\n\nbrctl addbr biv-1234567\nip link  set  biv-1234567 up    br-to-ovs.sh  \u70b9\u51fb\u6253\u5f00 ip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100  type  veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link  set  vib-1001100 up\nip link  set  vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567  type  veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link  set  vib-1234567 up\nip link  set  vio-1234567 up\novs-vsctl add-port br-int vio-1234567    openflow.sh  \u70b9\u51fb\u6253\u5f00 # \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a  # 1. \u4ece\u88680\u5f00\u59cb  # 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55  # 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3  # 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406  # \u83b7\u5f97openflow\u7aef\u53e3  vio1001100_ofport = ` ovs-vsctl get interface vio-1001100 ofport `  vio1234567_ofport = ` ovs-vsctl get interface vio-1234567 ofport `  vtep137_ofport = ` ovs-vsctl get interface vtep137 ofport `  vtep138_ofport = ` ovs-vsctl get interface vtep138 ofport `  # table 0  ## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1001100_ofport } , actions=goto_table:2 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1234567_ofport } , actions=goto_table:2  ## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep137_ofport } , actions=goto_table:10 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep138_ofport } , actions=goto_table:10  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=0, priority=0, actions=drop  # table 2  ## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20  ## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=2, priority=0, actions=drop  # table 10  ## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3  ## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:  ##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d  ##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7  ##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1001100_ofport } \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1234567_ofport }  ## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09 \novs-ofctl add-flow br-int  table=10, priority=0, actions=drop  # table 20  ## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09  ## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=20, priority=0, actions=goto_table:22  # table 22  ## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09 \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1001100_ofport } , actions=set_tunnel:1001100,output: ${ vtep137_ofport } , ${ vtep138_ofport } \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1234567_ofport } , actions=set_tunnel:1234567,output: ${ vtep137_ofport } , ${ vtep138_ofport }  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=22, priority=0, actions=drop     vm.sh  \u70b9\u51fb\u6253\u5f00 ip netns del s1-vm1\nip netns del s1-vm2\nip netns del s2-vm1\nip netns del s2-vm2\n\nip netns add s1-vm1\nip link add poi-s1-vm1  type  veth peer name pii-s1-vm1\nip link  set  pii-s1-vm1 netns s1-vm1\nip netns  exec  s1-vm1 ip link  set  lo up\nip netns  exec  s1-vm1 ip addr add  192 .168.1.1/24 dev pii-s1-vm1\nip netns  exec  s1-vm1 ip link  set  pii-s1-vm1 up\nip netns  exec  s1-vm1  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm1 up\nbrctl addif biv-1001100 poi-s1-vm1\n\nip netns add s1-vm2\nip link add poi-s1-vm2  type  veth peer name pii-s1-vm2\nip link  set  pii-s1-vm2 netns s1-vm2\nip netns  exec  s1-vm2 ip link  set  lo up\nip netns  exec  s1-vm2 ip addr add  192 .168.1.2/24 dev pii-s1-vm2\nip netns  exec  s1-vm2 ip link  set  pii-s1-vm2 up\nip netns  exec  s1-vm2  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm2 up\nbrctl addif biv-1001100 poi-s1-vm2\n\nip netns add s2-vm1\nip link add poi-s2-vm1  type  veth peer name pii-s2-vm1\nip link  set  pii-s2-vm1 netns s2-vm1\nip netns  exec  s2-vm1 ip link  set  lo up\nip netns  exec  s2-vm1 ip addr add  192 .168.2.1/24 dev pii-s2-vm1\nip netns  exec  s2-vm1 ip link  set  pii-s2-vm1 up\nip netns  exec  s2-vm1  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm1 up\nbrctl addif biv-1234567 poi-s2-vm1\n\nip netns add s2-vm2\nip link add poi-s2-vm2  type  veth peer name pii-s2-vm2\nip link  set  pii-s2-vm2 netns s2-vm2\nip netns  exec  s2-vm2 ip link  set  lo up\nip netns  exec  s2-vm2 ip addr add  192 .168.2.2/24 dev pii-s2-vm2\nip netns  exec  s2-vm2 ip link  set  pii-s2-vm2 up\nip netns  exec  s2-vm2  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm2 up\nbrctl addif biv-1234567 poi-s2-vm2", 
            "title": "Node 1"
        }, 
        {
            "location": "/test/test1/#node-2", 
            "text": "ovs.sh  \u70b9\u51fb\u6253\u5f00 # \u5220\u9664ovs\u6865\u63a5 \novs-vsctl del-br br-int # \u521b\u5efaovs\u6865\u63a5 \novs-vsctl add-br br-int # \u6e05\u7a7a\u6d41\u8868 \novs-ofctl del-flows br-int # \u521b\u5efavtep \novs-vsctl add-port br-int vtep136 --  set  interface vtep136  type = vxlan options:remote_ip = 172 .16.1.136 options:ttl = 64  options:in_key = flow options:out_key = flow\novs-vsctl add-port br-int vtep138 --  set  interface vtep138  type = vxlan options:remote_ip = 172 .16.1.138 options:ttl = 64  options:in_key = flow options:out_key = flow    bridge.sh  \u70b9\u51fb\u6253\u5f00 brctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link  set  biv-1001100 up\n\nbrctl addbr biv-1234567\nip link  set  biv-1234567 up    br-to-ovs.sh  \u70b9\u51fb\u6253\u5f00 ip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100  type  veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link  set  vib-1001100 up\nip link  set  vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567  type  veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link  set  vib-1234567 up\nip link  set  vio-1234567 up\novs-vsctl add-port br-int vio-1234567    openflow.sh  \u70b9\u51fb\u6253\u5f00 # \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a  # 1. \u4ece\u88680\u5f00\u59cb  # 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55  # 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3  # 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406  # \u83b7\u5f97openflow\u7aef\u53e3  vio1001100_ofport = ` ovs-vsctl get interface vio-1001100 ofport `  vio1234567_ofport = ` ovs-vsctl get interface vio-1234567 ofport `  vtep136_ofport = ` ovs-vsctl get interface vtep136 ofport `  vtep138_ofport = ` ovs-vsctl get interface vtep138 ofport `  # table 0  ## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1001100_ofport } , actions=goto_table:2 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1234567_ofport } , actions=goto_table:2  ## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep136_ofport } , actions=goto_table:10 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep138_ofport } , actions=goto_table:10  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=0, priority=0, actions=drop  # table 2  ## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20  ## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=2, priority=0, actions=drop  # table 10  ## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3  ## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:  ##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d  ##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7  ##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1001100_ofport } \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1234567_ofport }  ## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09 \novs-ofctl add-flow br-int  table=10, priority=0, actions=drop  # table 20  ## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09  ## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=20, priority=0, actions=goto_table:22  # table 22  ## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09 \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1001100_ofport } , actions=set_tunnel:1001100,output: ${ vtep136_ofport } , ${ vtep138_ofport } \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1234567_ofport } , actions=set_tunnel:1234567,output: ${ vtep136_ofport } , ${ vtep138_ofport }  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=22, priority=0, actions=drop     vm.sh  \u70b9\u51fb\u6253\u5f00 ip netns del s1-vm3\nip netns del s1-vm4\nip netns del s2-vm3\nip netns del s2-vm4\n\nip netns add s1-vm3\nip link add poi-s1-vm3  type  veth peer name pii-s1-vm3\nip link  set  pii-s1-vm3 netns s1-vm3\nip netns  exec  s1-vm3 ip link  set  lo up\nip netns  exec  s1-vm3 ip addr add  192 .168.1.3/24 dev pii-s1-vm3\nip netns  exec  s1-vm3 ip link  set  pii-s1-vm3 up\nip netns  exec  s1-vm3  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm3 up\nbrctl addif biv-1001100 poi-s1-vm3\n\nip netns add s1-vm4\nip link add poi-s1-vm4  type  veth peer name pii-s1-vm4\nip link  set  pii-s1-vm4 netns s1-vm4\nip netns  exec  s1-vm4 ip link  set  lo up\nip netns  exec  s1-vm4 ip addr add  192 .168.1.4/24 dev pii-s1-vm4\nip netns  exec  s1-vm4 ip link  set  pii-s1-vm4 up\nip netns  exec  s1-vm4  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm4 up\nbrctl addif biv-1001100 poi-s1-vm4\n\nip netns add s2-vm3\nip link add poi-s2-vm3  type  veth peer name pii-s2-vm3\nip link  set  pii-s2-vm3 netns s2-vm3\nip netns  exec  s2-vm3 ip link  set  lo up\nip netns  exec  s2-vm3 ip addr add  192 .168.2.3/24 dev pii-s2-vm3\nip netns  exec  s2-vm3 ip link  set  pii-s2-vm3 up\nip netns  exec  s2-vm3  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm3 up\nbrctl addif biv-1234567 poi-s2-vm3\n\nip netns add s2-vm4\nip link add poi-s2-vm4  type  veth peer name pii-s2-vm4\nip link  set  pii-s2-vm4 netns s2-vm4\nip netns  exec  s2-vm4 ip link  set  lo up\nip netns  exec  s2-vm4 ip addr add  192 .168.2.4/24 dev pii-s2-vm4\nip netns  exec  s2-vm4 ip link  set  pii-s2-vm4 up\nip netns  exec  s2-vm4  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm4 up\nbrctl addif biv-1234567 poi-s2-vm4", 
            "title": "Node 2"
        }, 
        {
            "location": "/test/test1/#node-3", 
            "text": "ovs.sh  \u70b9\u51fb\u6253\u5f00 # \u5220\u9664ovs\u6865\u63a5 \novs-vsctl del-br br-int # \u521b\u5efaovs\u6865\u63a5 \novs-vsctl add-br br-int # \u6e05\u7a7a\u6d41\u8868 \novs-ofctl del-flows br-int # \u521b\u5efavtep \novs-vsctl add-port br-int vtep137 --  set  interface vtep137  type = vxlan options:remote_ip = 172 .16.1.137 options:ttl = 64  options:in_key = flow options:out_key = flow\novs-vsctl add-port br-int vtep136 --  set  interface vtep136  type = vxlan options:remote_ip = 172 .16.1.136 options:ttl = 64  options:in_key = flow options:out_key = flow    bridge.sh  \u70b9\u51fb\u6253\u5f00 brctl delbr biv-1001100\nbrctl delbr biv-1234567\n\nbrctl addbr biv-1001100\nip link  set  biv-1001100 up\n\nbrctl addbr biv-1234567\nip link  set  biv-1234567 up    br-to-ovs.sh  \u70b9\u51fb\u6253\u5f00 ip link delete vib-1001100\nip link delete vib-1234567\n\nip link add vib-1001100  type  veth peer name vio-1001100\nbrctl addif biv-1001100 vib-1001100\nip link  set  vib-1001100 up\nip link  set  vio-1001100 up\novs-vsctl add-port br-int vio-1001100\n\nip link add vib-1234567  type  veth peer name vio-1234567\nbrctl addif biv-1234567 vib-1234567\nip link  set  vib-1234567 up\nip link  set  vio-1234567 up\novs-vsctl add-port br-int vio-1234567    openflow.sh  \u70b9\u51fb\u6253\u5f00 # \u5199openflow\u89c4\u5219\u987a\u5e8f\uff1a  # 1. \u4ece\u88680\u5f00\u59cb  # 2. \u4e3a\u6bcf\u4e2a\u8868\u4e4b\u95f4\u7559\u4e00\u4e9b\u8868\uff0c\u7528\u4e8e\u4eca\u540e\u6269\u5c55  # 3. \u8df3\u8868\u65f6\u5019\u53ea\u5f80\u9ad8\u4e86\u8df3\uff0c\u4e0d\u5f80\u4f4e\u4e86\u8df3  # 4. priority=1\u7684\u5199\u89c4\u5219\uff0c\u53ef\u5b58\u5728\u591a\u6761\uff1bpriotity=0\u7684\u53ea\u80fd\u6709\u4e00\u6761\uff0c\u7528\u4e8e\u5176\u4f59\u6570\u636e\u5305\u5904\u7406  # \u83b7\u5f97openflow\u7aef\u53e3  vio1001100_ofport = ` ovs-vsctl get interface vio-1001100 ofport `  vio1234567_ofport = ` ovs-vsctl get interface vio-1234567 ofport `  vtep137_ofport = ` ovs-vsctl get interface vtep137 ofport `  vtep136_ofport = ` ovs-vsctl get interface vtep136 ofport `  # table 0  ## \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1001100_ofport } , actions=goto_table:2 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vio1234567_ofport } , actions=goto_table:2  ## \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep137_ofport }  actions=goto_table:10 \novs-ofctl add-flow br-int  table=0, priority=1, in_port= ${ vtep136_ofport }  actions=goto_table:10  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=0, priority=0, actions=drop  # table 2  ## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00 actions=goto_table:20  ## \u591a\u64ad\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=goto_table:22  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=2, priority=0, actions=drop  # table 10  ## \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3  ## \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:  ##   1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d  ##   2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7  ##   3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1001100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1001100_ofport } \novs-ofctl add-flow br-int  table=10, priority=1, tun_id=1234567, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output: ${ vio1234567_ofport }  ## \u5176\u4f59DROP\uff08\u53ef\u9009\uff09 \novs-ofctl add-flow br-int  table=10, priority=0, actions=drop  # table 20  ## \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09  ## \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406 \novs-ofctl add-flow br-int  table=20, priority=0, actions=goto_table:22  # table 22  ## \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09 \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1001100_ofport } , actions=set_tunnel:1001100,output: ${ vtep137_ofport } , ${ vtep136_ofport } \novs-ofctl add-flow br-int  table=22, priority=1, in_port= ${ vio1234567_ofport } , actions=set_tunnel:1234567,output: ${ vtep137_ofport } , ${ vtep136_ofport }  ## \u5176\u4f59DROP \novs-ofctl add-flow br-int  table=22, priority=0, actions=drop     vm.sh  \u70b9\u51fb\u6253\u5f00 ip netns del s1-vm5\nip netns del s1-vm6\nip netns del s2-vm5\nip netns del s2-vm6\n\nip netns add s1-vm5\nip link add poi-s1-vm5  type  veth peer name pii-s1-vm5\nip link  set  pii-s1-vm5 netns s1-vm5\nip netns  exec  s1-vm5 ip link  set  lo up\nip netns  exec  s1-vm5 ip addr add  192 .168.1.5/24 dev pii-s1-vm5\nip netns  exec  s1-vm5 ip link  set  pii-s1-vm5 up\nip netns  exec  s1-vm5  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm5 up\nbrctl addif biv-1001100 poi-s1-vm5\n\nip netns add s1-vm6\nip link add poi-s1-vm6  type  veth peer name pii-s1-vm6\nip link  set  pii-s1-vm6 netns s1-vm6\nip netns  exec  s1-vm6 ip link  set  lo up\nip netns  exec  s1-vm6 ip addr add  192 .168.1.6/24 dev pii-s1-vm6\nip netns  exec  s1-vm6 ip link  set  pii-s1-vm6 up\nip netns  exec  s1-vm6  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s1-vm6 up\nbrctl addif biv-1001100 poi-s1-vm6\n\nip netns add s2-vm5\nip link add poi-s2-vm5  type  veth peer name pii-s2-vm5\nip link  set  pii-s2-vm5 netns s2-vm5\nip netns  exec  s2-vm5 ip link  set  lo up\nip netns  exec  s2-vm5 ip addr add  192 .168.2.5/24 dev pii-s2-vm5\nip netns  exec  s2-vm5 ip link  set  pii-s2-vm5 up\nip netns  exec  s2-vm5  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm5 up\nbrctl addif biv-1234567 poi-s2-vm5\n\nip netns add s2-vm6\nip link add poi-s2-vm6  type  veth peer name pii-s2-vm6\nip link  set  pii-s2-vm6 netns s2-vm6\nip netns  exec  s2-vm6 ip link  set  lo up\nip netns  exec  s2-vm6 ip addr add  192 .168.2.6/24 dev pii-s2-vm6\nip netns  exec  s2-vm6 ip link  set  pii-s2-vm6 up\nip netns  exec  s2-vm6  echo   1    /proc/sys/net/ipv6/conf/all/disable_ipv6\nip link  set  poi-s2-vm6 up\nbrctl addif biv-1234567 poi-s2-vm6", 
            "title": "Node 3"
        }, 
        {
            "location": "/test/stress_main/", 
            "text": "\u670d\u52a1\u5668\uff1aDell R730\uff0c\u7f51\u5361\u4e3a\u677f\u8f7d\u96c6\u6210\u7535\u53e3\u4e07\u5146\uff08\u652f\u6301udp offload\uff09\uff0cos\u4e3acentos 7.3\n\n\n\u4ea4\u6362\u673a\uff1aDell\u4e07\u5146\u4ea4\u6362\u673a\n\n\nkvm\uff1aqemu-kvm 1.5.3\uff0c\u7f51\u5361virtio\uff0cos\u4e3acentos 7.3 4\u68388G\n\n\niptables\u3001ebtables\u3001selinux\u5747\u5904\u4e8edisable\u72b6\u6001\uff0c\u4e0d\u8fc7openvswitch\u4f1a\u5f3a\u5236\u52a0\u8f7dconntrack\u6a21\u5757\n\n\n\u6d4b\u8bd5\u65b9\u6cd5\uff1a\u4f7f\u7528iperf\u5206\u522b\u6d4b\u8bd5tcp\u548cudp\uff08\u53ea\u6d4b\u8bd5\u5355\u64ad\uff09\uff0c\u6bcf\u4e00\u4e2a\u6d4b\u8bd5\u5b8c\u6210\u540e\u5747\u91cd\u542f\u7269\u7406\u673a\n\n\n\u6d4b\u8bd5\u547d\u4ee4\uff1a\n\n\n\n\n\n\ntcp\n\n\nclient: iperf -b 10G -t 300 -P 3 -c \u76ee\u6807ip\n\n\nserver: iperf -s\n\n\n\n\n\n\nudp\n\n\nclient: iperf -u -b 10G -t 300 -P 3 -c \u76ee\u6807ip\n\n\nserver: iperf -u -s\n\n\n\n\n\n\n\u6d4b\u8bd5\u7ed3\u679c\uff1atcp\u7684client\u548cserver\u6d41\u91cf\u76f8\u540c\uff0cudp\u7684client\u4e3a\u5e73\u5747\u6bcf\u79d2\u51fa\u7ad9\u6d41\u91cf\uff0cserver\u4e3a\u5e73\u5747\u6bcf\u79d2\u5165\u7ad9\u6d41\u91cf", 
            "title": "2.1. \u73af\u5883\u8bf4\u660e"
        }, 
        {
            "location": "/test/stress_one/", 
            "text": "bridge\n\n\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 10.7Gb/s\nudp:\n    client 4.93Gb/s\n    server 4.93Gb/s\n\n\n\n\n\u73af\u5883\nbrctl addbr br1\nip link set br1 up\nip netns add ns1\nip netns add ns2\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns2-veth-in netns ns2\nip link set ns1-veth-out up\nip link set ns2-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\nbrctl addif br1 ns2-veth-out\n\n\n\nkvm - kvm\n\n\ntcp: 5.57Gb/s\nudp:\n    client 5.58Gb/s\n    server 5.39Gb/s\n\n\n\n\novs\n\n\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 10.7Gb/s\nudp:\n    client 3.85Gb/s\n    server 3.85Gb/s\n\n\n\n\n\u73af\u5883\novs-vsctl add-br ovsbr\nip netns add ns1\nip netns add ns2\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns2-veth-in netns ns2\nip link set ns1-veth-out up\nip link set ns2-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\novs-vsctl add-port ovsbr ns2-veth-out\n\n\n\nns - ns\uff08ovs-port\uff09\n\n\novs-port(internal)\n\n\ntcp: 10.7Gb/s\nudp:\n    client 3.91Gb/s\n    server 3.91Gb/s\n\n\n\n\n\u73af\u5883\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns1\nip netns add ns2\nip link set ns1 netns ns1\nip link set ns2 netns ns2\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up\n\n\n\nkvm - kvm\n\n\ntcp: 5.83Gb/s\nudp:\n    client 5.33Gb/s\n    server 5.18Gb/s\n\n\n\n\nxml\u914d\u7f6e\ninterface\n \ntype=\nbridge\n\n  \nmac\n \naddress=\n52:54:00:c8:3b:ea\n/\n\n  \nsource\n \nbridge=\novsbr\n/\n\n\n  \nvirtualport\n \ntype=\nopenvswitch\n/\n\n\n  \ntarget\n \ndev=\nvmeth0-vm1\n/\n\n  \nmodel\n \ntype=\nvirtio\n/\n\n\n/interface", 
            "title": "2.2. \u540c\u5bbf\u4e3b"
        }, 
        {
            "location": "/test/stress_one/#bridge", 
            "text": "", 
            "title": "bridge"
        }, 
        {
            "location": "/test/stress_one/#ns-nsveth", 
            "text": "tcp: 10.7Gb/s\nudp:\n    client 4.93Gb/s\n    server 4.93Gb/s  \u73af\u5883 brctl addbr br1\nip link set br1 up\nip netns add ns1\nip netns add ns2\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns2-veth-in netns ns2\nip link set ns1-veth-out up\nip link set ns2-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\nbrctl addif br1 ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_one/#kvm-kvm", 
            "text": "tcp: 5.57Gb/s\nudp:\n    client 5.58Gb/s\n    server 5.39Gb/s", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_one/#ovs", 
            "text": "", 
            "title": "ovs"
        }, 
        {
            "location": "/test/stress_one/#ns-nsveth_1", 
            "text": "tcp: 10.7Gb/s\nudp:\n    client 3.85Gb/s\n    server 3.85Gb/s  \u73af\u5883 ovs-vsctl add-br ovsbr\nip netns add ns1\nip netns add ns2\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns2-veth-in netns ns2\nip link set ns1-veth-out up\nip link set ns2-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\novs-vsctl add-port ovsbr ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_one/#ns-nsovs-port", 
            "text": "ovs-port(internal)  tcp: 10.7Gb/s\nudp:\n    client 3.91Gb/s\n    server 3.91Gb/s  \u73af\u5883 ovs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns1\nip netns add ns2\nip link set ns1 netns ns1\nip link set ns2 netns ns2\nip netns exec ns1 ip link set lo up\nip netns exec ns2 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_one/#kvm-kvm_1", 
            "text": "tcp: 5.83Gb/s\nudp:\n    client 5.33Gb/s\n    server 5.18Gb/s  xml\u914d\u7f6e interface   type= bridge \n   mac   address= 52:54:00:c8:3b:ea / \n   source   bridge= ovsbr /     virtualport   type= openvswitch /     target   dev= vmeth0-vm1 / \n   model   type= virtio /  /interface", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_novxlan/", 
            "text": "\u7269\u7406\u673a\n\n\n\n\nem1 - em1\n\n\ntcp: 7.02Gb/s\nudp:\n    client 8.14Gb/s\n    server 8.08Gb/s\n\n\n\n\nbridge - bridge\n\n\nbridge-\nem1 - em1\n-bridge\uff08bridge\u4e3a3\u5c42\uff09\n\n\ntcp: 6.62Gb/s\nudp:\n    client 8.19Gb/s\n    server 7.94Gb/s\n\n\n\n\nbridge\n\n\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 6.24Gb/s\nudp:\n    client 6.89Gb/s\n    server 6.88Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nbrctl addbr br1\nip link set br1 up\nifconfig em1 0.0.0.0\nbrctl addif br1 em1\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nbrctl addbr br1\nip link set br1 up\nifconfig em1 0.0.0.0\nbrctl addif br1 em1\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out\n\n\n\nkvm - kvm\n\n\ntcp: 5.94Gb/s\nudp:\n    client 6.41Gb/s\n    server 4.93Gb/s\n\n\n\n\novs\n\n\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 6.09Gb/s\nudp:\n    client 5.94Gb/s\n    server 5.60Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\nHost2:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out\n\n\n\nns - ns\uff08ovs-port\uff09\n\n\novs-port(internal)\n\n\ntcp: 6.28Gb/s\nudp:\n    client 7.05Gb/s\n    server 7.04Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\nHost2:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up\n\n\n\nkvm - kvm\n\n\ntcp: 5.50Gb/s\nudp:\n    client 8.50Gb/s\n    server 5.90Gb/s", 
            "title": "2.3. \u4e0d\u540c\u5bbf\u4e3b(\u65e0\u5c01\u88c5)"
        }, 
        {
            "location": "/test/stress_two_novxlan/#_1", 
            "text": "", 
            "title": "\u7269\u7406\u673a"
        }, 
        {
            "location": "/test/stress_two_novxlan/#em1-em1", 
            "text": "tcp: 7.02Gb/s\nudp:\n    client 8.14Gb/s\n    server 8.08Gb/s", 
            "title": "em1 - em1"
        }, 
        {
            "location": "/test/stress_two_novxlan/#bridge-bridge", 
            "text": "bridge- em1 - em1 -bridge\uff08bridge\u4e3a3\u5c42\uff09  tcp: 6.62Gb/s\nudp:\n    client 8.19Gb/s\n    server 7.94Gb/s", 
            "title": "bridge - bridge"
        }, 
        {
            "location": "/test/stress_two_novxlan/#bridge", 
            "text": "", 
            "title": "bridge"
        }, 
        {
            "location": "/test/stress_two_novxlan/#ns-nsveth", 
            "text": "tcp: 6.24Gb/s\nudp:\n    client 6.89Gb/s\n    server 6.88Gb/s  \u73af\u5883 Host1:\nbrctl addbr br1\nip link set br1 up\nifconfig em1 0.0.0.0\nbrctl addif br1 em1\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nbrctl addbr br1\nip link set br1 up\nifconfig em1 0.0.0.0\nbrctl addif br1 em1\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_novxlan/#kvm-kvm", 
            "text": "tcp: 5.94Gb/s\nudp:\n    client 6.41Gb/s\n    server 4.93Gb/s", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_novxlan/#ovs", 
            "text": "", 
            "title": "ovs"
        }, 
        {
            "location": "/test/stress_two_novxlan/#ns-nsveth_1", 
            "text": "tcp: 6.09Gb/s\nudp:\n    client 5.94Gb/s\n    server 5.60Gb/s  \u73af\u5883 Host1:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\nHost2:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_novxlan/#ns-nsovs-port", 
            "text": "ovs-port(internal)  tcp: 6.28Gb/s\nudp:\n    client 7.05Gb/s\n    server 7.04Gb/s  \u73af\u5883 Host1:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\nHost2:\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr em1\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_two_novxlan/#kvm-kvm_1", 
            "text": "tcp: 5.50Gb/s\nudp:\n    client 8.50Gb/s\n    server 5.90Gb/s", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/", 
            "text": "bridge\n\n\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 4.45Gb/s\nudp:\n    client 5.36Gb/s\n    server 5.36Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out\n\n\n\nkvm - kvm\n\n\ntcp: 7.20Gb/s\nudp:\n    client 8.23Gb/s\n    server 3.66Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\n\nHost2:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\n\n\n\novs\n\n\n\n\nem1 - - - vtep - ovsbr\n\n\nkey\u6307\u5b9avni\n\n\n\u7531ovs\u6765\u505avxlan\u7684\u5c01\u88c5\u548c\u89e3\u5c01\u88c5\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 4.23Gb/s\nudp:\n    client 4.55Gb/s\n    server 4.30Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out\n\n\n\nns - ns\uff08ovs-port\uff09\n\n\novs-port(internal)\n\n\ntcp: 4.65Gb/s\nudp:\n    client 4.80Gb/s\n    server 4.50Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up\n\n\n\nkvm - kvm\n\n\ntcp: 8.51Gb/s\nudp:\n    client 5.82Gb/s\n    server 4.31Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\n\n\n\nkey\u4e3aflow\n\n\n\u81ea\u5df1\u5199openflow\u6765\u505avxlan\u7684\u5c01\u88c5\u548c\u89e3\u5c01\u88c5\n\n\nns - ns\uff08veth\uff09\n\n\ntcp: 4.43Gb/s\nudp:\n    client 4.75Gb/s\n    server 4.42Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns1-veth-out ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns2-veth-out ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\n\nns - ns\uff08ovs-port\uff09\n\n\novs-port(internal)\n\n\ntcp: 4.28Gb/s\nudp:\n    client 5.41Gb/s\n    server 4.92Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip link set ns1 up\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns1 ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip link set ns2 up\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns2 ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\n\nkvm - kvm\n\n\ntcp: 8.77Gb/s\nudp:\n    client 5.43Gb/s\n    server 4.52Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n\n\n\u542f\u52a8\u865a\u62df\u673avm1\u548cvm3\nHost1:\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nvm_ofport=`ovs-vsctl get interface vmeth0-vm1 ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecevm\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vm_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230vm\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${vm_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${vm_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\nHost2:\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nvm_ofport=`ovs-vsctl get interface vmeth0-vm3 ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecevm\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vm_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230vm\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${vm_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${vm_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n\n\novs-bridge\n\n\n\n\nem1 - - - vtep - ovsbr - bridge\n\n\n\n\nkey\u6307\u5b9avni\n\n\nns - ns\uff08veth\uff09\n\n\novsbr\u548cbridge\u4e4b\u95f4\u7528veth\n\n\n\u4e0d\u505a\u6d4b\u8bd5\uff08\u65e0\u610f\u4e49\uff09\uff0c\u56e0\u4e3aveth\u4e0d\u4ec5\u7ba1\u7406\u9ebb\u70e6\uff0c\u800c\u4e14\u6027\u80fd\u4e0d\u5982ovs-port(internal)\n\n\nns - ns\uff08ovs-port\uff09\n\n\novsbr\u548cbridge\u4e4b\u95f4\u7528ovs-port(internal)\n\n\ntcp: 4.03Gb/s\nudp:\n    client 4.19Gb/s\n    server 3.82Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out\n\n\n\nkvm - kvm\n\n\ntcp: 8.44Gb/s\nudp:\n    client 5.46Gb/s\n    server 3.85Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\n\n\nkey\u4e3aflow\n\n\nns - ns\uff08veth\uff09\n\n\novsbr\u548cbridge\u4e4b\u95f4\u7528veth\n\n\n\u4e0d\u505a\u6d4b\u8bd5\uff08\u65e0\u610f\u4e49\uff09\uff0c\u56e0\u4e3aveth\u4e0d\u4ec5\u7ba1\u7406\u9ebb\u70e6\uff0c\u800c\u4e14\u6027\u80fd\u4e0d\u5982ovs-port(internal)\n\n\nns - ns\uff08ovs-port\uff09\n\n\novsbr\u548cbridge\u4e4b\u95f4\u7528ovs-port(internal)\n\n\ntcp: 4.25Gb/s\nudp:\n    client 4.29Gb/s\n    server 2.88Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# \u521b\u5efalinux bridge\nbrctl addbr br1\nip link set br1 up\n\n# linux bridge\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-br ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${patch_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n# ns\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# \u521b\u5efalinux bridge\nbrctl addbr br1\nip link set br1 up\n\n# linux bridge\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-br ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2\n\n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=0, priority=0, actions=drop\n\n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=2, priority=0, actions=drop\n\n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr \ntable=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport}\n\n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr \ntable=10, priority=0, actions=drop\n\n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr \ntable=22, priority=1, in_port=${patch_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport}\n\n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr \ntable=22, priority=0, actions=drop\n\n\n# ns\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out\n\n\n\nkvm - kvm\n\n\ntcp: 6.89Gb/s\nudp:\n    client 4.72Gb/s\n    server 4.55Gb/s\n\n\n\n\n\u73af\u5883\n\u548c\u4e0a\u9762\u8fd9\u4e2a\u4e00\u6837\uff0c\u53ea\u662f\u4e0d\u7528# ns\u90e8\u5206\nNeutron\u6a21\u5f0f\n\n\n\n\nvm -\n bridge --veth\n br-int --patch\n br-tun -\n vtep\uff0c\u5373openstack\u7684\u6027\u80fd\u6d4b\u8bd5\n\n\nkvm - kvm\n\n\ntcp: 8.52Gb/s\nudp:\n    client 4.48Gb/s\n    server 3.96Gb/s\n\n\n\n\n\u73af\u5883\nHost1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# bridge\nbrctl addbr br1\nip link set br1 up\n\n# veth\nip link add veth-b type veth peer name veth-o\nip link set veth-b up\nip link set veth-o up\nbrctl addif br1 veth-b\n\n# br-int\novs-vsctl add-br br-int\novs-vsctl add-port br-int veth-o\novs-vsctl set port veth-o tag=1\n\n# patch\novs-vsctl add-port br-int patch-tun -- set interface patch-tun type=patch options:peer=patch-int\n\n# br-tun\novs-vsctl add-br br-tun\novs-ofctl del-flows br-tun\novs-vsctl add-port br-tun patch-int -- set interface patch-int type=patch options:peer=patch-tun\n\n# vtep\novs-vsctl add-port br-tun vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-int ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\novs-ofctl add-flow br-tun \ntable=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2\n\novs-ofctl add-flow br-tun \ntable=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:4\n\n\n## table 2\novs-ofctl add-flow br-tun \ntable=2, priority=0, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\novs-ofctl add-flow br-tun \ntable=2, priority=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n## table 4\novs-ofctl add-flow br-tun \ntable=4, priority=1, tun_id=0x3e9, actions=mod_vlan_vid:1, goto_table:10\n\novs-ofctl add-flow br-tun \ntable=4, priority=0, actions=drop\n\n\n## table 10\novs-ofctl add-flow br-tun \ntable=10, priority=1, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0-\nNXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport}\n\n\n## table 20\novs-ofctl add-flow br-tun \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\novs-ofctl add-flow br-tun \ntable=22, priority=1, dl_vlan=1, actions=strip_vlan,set_tunnel:0x3e9,output:${vtepHost2_ofport}\n\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# bridge\nbrctl addbr br1\nip link set br1 up\n\n# veth\nip link add veth-b type veth peer name veth-o\nip link set veth-b up\nip link set veth-o up\nbrctl addif br1 veth-b\n\n# br-int\novs-vsctl add-br br-int\novs-vsctl add-port br-int veth-o\novs-vsctl set port veth-o tag=1\n\n# patch\novs-vsctl add-port br-int patch-tun -- set interface patch-tun type=patch options:peer=patch-int\n\n# br-tun\novs-vsctl add-br br-tun\novs-ofctl del-flows br-tun\novs-vsctl add-port br-tun patch-int -- set interface patch-int type=patch options:peer=patch-tun\n\n# vtep\novs-vsctl add-port br-tun vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-int ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\novs-ofctl add-flow br-tun \ntable=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2\n\novs-ofctl add-flow br-tun \ntable=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:4\n\n\n## table 2\novs-ofctl add-flow br-tun \ntable=2, priority=0, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20\n\novs-ofctl add-flow br-tun \ntable=2, priority=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22\n\n\n## table 4\novs-ofctl add-flow br-tun \ntable=4, priority=1, tun_id=0x3e9, actions=mod_vlan_vid:1, goto_table:10\n\novs-ofctl add-flow br-tun \ntable=4, priority=0, actions=drop\n\n\n## table 10\novs-ofctl add-flow br-tun \ntable=10, priority=1, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0-\nNXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]-\nNXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport}\n\n\n## table 20\novs-ofctl add-flow br-tun \ntable=20, priority=0, actions=goto_table:22\n\n\n## table 22\novs-ofctl add-flow br-tun \ntable=22, priority=1, dl_vlan=1, actions=strip_vlan,set_tunnel:0x3e9,output:${vtepHost1_ofport}", 
            "title": "2.4. \u4e0d\u540c\u5bbf\u4e3b(vxlan\u5c01\u88c5)"
        }, 
        {
            "location": "/test/stress_two_vxlan/#bridge", 
            "text": "", 
            "title": "bridge"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsveth", 
            "text": "tcp: 4.45Gb/s\nudp:\n    client 5.36Gb/s\n    server 5.36Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm", 
            "text": "tcp: 7.20Gb/s\nudp:\n    client 8.23Gb/s\n    server 3.66Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100\n\nHost2:\nip link set em1 mtu 1550\nbrctl addbr br1\nip link set br1 up\nip link add vtep-100 mtu 1500 type vxlan id 100 group 239.0.0.100 ttl 64 dev em1 dstport 4789\nip link set vtep-100 up\nbrctl addif br1 vtep-100", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ovs", 
            "text": "em1 - - - vtep - ovsbr", 
            "title": "ovs"
        }, 
        {
            "location": "/test/stress_two_vxlan/#keyvni", 
            "text": "\u7531ovs\u6765\u505avxlan\u7684\u5c01\u88c5\u548c\u89e3\u5c01\u88c5", 
            "title": "key\u6307\u5b9avni"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsveth_1", 
            "text": "tcp: 4.23Gb/s\nudp:\n    client 4.55Gb/s\n    server 4.30Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsovs-port", 
            "text": "ovs-port(internal)  tcp: 4.65Gb/s\nudp:\n    client 4.80Gb/s\n    server 4.50Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm_1", 
            "text": "tcp: 8.51Gb/s\nudp:\n    client 5.82Gb/s\n    server 4.31Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/#keyflow", 
            "text": "\u81ea\u5df1\u5199openflow\u6765\u505avxlan\u7684\u5c01\u88c5\u548c\u89e3\u5c01\u88c5", 
            "title": "key\u4e3aflow"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsveth_2", 
            "text": "tcp: 4.43Gb/s\nudp:\n    client 4.75Gb/s\n    server 4.42Gb/s  \u73af\u5883 Host1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns1-veth-out\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns1-veth-out ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop \n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\novs-vsctl add-port ovsbr ns2-veth-out\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns2-veth-out ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsovs-port_1", 
            "text": "ovs-port(internal)  tcp: 4.28Gb/s\nudp:\n    client 5.41Gb/s\n    server 4.92Gb/s  \u73af\u5883 Host1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr ns1 -- set interface ns1 type=internal\nip link set ns1 up\nip netns add ns1\nip link set ns1 netns ns1\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1 192.168.1.1 netmask 255.255.255.0 up\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns1 ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop \n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# ns\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr ns2 -- set interface ns2 type=internal\nip link set ns2 up\nip netns add ns2\nip link set ns2 netns ns2\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2 192.168.1.2 netmask 255.255.255.0 up\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nns_ofport=`ovs-vsctl get interface ns2 ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecens\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${ns_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230ns\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${ns_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${ns_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm_2", 
            "text": "tcp: 8.77Gb/s\nudp:\n    client 5.43Gb/s\n    server 4.52Gb/s  \u73af\u5883 Host1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow  \u542f\u52a8\u865a\u62df\u673avm1\u548cvm3 Host1:\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nvm_ofport=`ovs-vsctl get interface vmeth0-vm1 ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecevm\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vm_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230vm\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${vm_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${vm_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop \n\n\nHost2:\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\nvm_ofport=`ovs-vsctl get interface vmeth0-vm3 ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecevm\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vm_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230vm\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${vm_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${vm_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ovs-bridge", 
            "text": "em1 - - - vtep - ovsbr - bridge", 
            "title": "ovs-bridge"
        }, 
        {
            "location": "/test/stress_two_vxlan/#keyvni_1", 
            "text": "", 
            "title": "key\u6307\u5b9avni"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsveth_3", 
            "text": "ovsbr\u548cbridge\u4e4b\u95f4\u7528veth  \u4e0d\u505a\u6d4b\u8bd5\uff08\u65e0\u610f\u4e49\uff09\uff0c\u56e0\u4e3aveth\u4e0d\u4ec5\u7ba1\u7406\u9ebb\u70e6\uff0c\u800c\u4e14\u6027\u80fd\u4e0d\u5982ovs-port(internal)", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsovs-port_2", 
            "text": "ovsbr\u548cbridge\u4e4b\u95f4\u7528ovs-port(internal)  tcp: 4.03Gb/s\nudp:\n    client 4.19Gb/s\n    server 3.82Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm_3", 
            "text": "tcp: 8.44Gb/s\nudp:\n    client 5.46Gb/s\n    server 3.85Gb/s  \u73af\u5883 Host1:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\nHost2:\nip link set em1 mtu 1550\novs-vsctl add-br ovsbr\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:key=100\nbrctl addbr br1\nip link set br1 up\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/#keyflow_1", 
            "text": "", 
            "title": "key\u4e3aflow"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsveth_4", 
            "text": "ovsbr\u548cbridge\u4e4b\u95f4\u7528veth  \u4e0d\u505a\u6d4b\u8bd5\uff08\u65e0\u610f\u4e49\uff09\uff0c\u56e0\u4e3aveth\u4e0d\u4ec5\u7ba1\u7406\u9ebb\u70e6\uff0c\u800c\u4e14\u6027\u80fd\u4e0d\u5982ovs-port(internal)", 
            "title": "ns - ns\uff08veth\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#ns-nsovs-port_3", 
            "text": "ovsbr\u548cbridge\u4e4b\u95f4\u7528ovs-port(internal)  tcp: 4.25Gb/s\nudp:\n    client 4.29Gb/s\n    server 2.88Gb/s  \u73af\u5883 Host1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# \u521b\u5efalinux bridge\nbrctl addbr br1\nip link set br1 up\n\n# linux bridge\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-br ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\n### \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${patch_ofport}, actions=set_tunnel:100,output:${vtepHost2_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop \n\n# ns\nip netns add ns1\nip link add ns1-veth-in type veth peer name ns1-veth-out\nip link set ns1-veth-in netns ns1\nip link set ns1-veth-out up\nip netns exec ns1 ip link set lo up\nip netns exec ns1 ifconfig ns1-veth-in 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br1 ns1-veth-out\n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# \u521b\u5efaovs\u6865\u63a5\novs-vsctl add-br ovsbr\n\n# \u6e05\u7a7a\u6d41\u8868\novs-ofctl del-flows ovsbr\n\n# \u521b\u5efavtep\novs-vsctl add-port ovsbr vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# \u521b\u5efalinux bridge\nbrctl addbr br1\nip link set br1 up\n\n# linux bridge\u5230ovsbr\u7684patch-port\novs-vsctl add-port ovsbr patch-br -- set interface patch-br type=internal\nip link set patch-br up\nbrctl addif br1 patch-br\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-br ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\n### \u4ecelinux-bridge\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 2\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2 \n\n### \u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u6254\u7ed9table 10\u5904\u7406\novs-ofctl add-flow ovsbr  table=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:10 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=0, priority=0, actions=drop \n\n## table 2\n## \u5355\u64ad\u5305\uff0c\u6254\u7ed9table 20\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \n\n## \u591a\u64ad\u5305\u548c\u5e7f\u64ad\u5305\uff0c\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=2, priority=1, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=2, priority=0, actions=drop \n\n## table 10\n### \u5b66\u4e60\u4ecevtep\u8fc7\u6765\u7684\u6570\u636e\u5305\uff0c\u5f80table 20\u4e2d\u6dfb\u52a0\u8fd4\u7a0b\u89c4\u5219\uff0c\u7136\u540e\u8f93\u51fa\u5230linux-bridge\u7aef\u53e3\n### \u5177\u4f53\u5b66\u4e60\u5185\u5bb9:\n###  1. \u5305\u7684\u76ee\u7684mac\u8ddf\u5f53\u524d\u7684\u6e90mac\u5339\u914d\n###  2. \u5c06tunnel\u53f7\u4fee\u6539\u4e3a\u5f53\u524d\u7684tunnel\u53f7\n###  3. \u4ece\u5f53\u524d\u5165\u53e3\u53d1\u51fa\novs-ofctl add-flow ovsbr  table=10, priority=1, tun_id=100, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport} \n\n### \u5176\u4f59DROP\uff08\u53ef\u9009\uff09\novs-ofctl add-flow ovsbr  table=10, priority=0, actions=drop \n\n## table 20\n### \u6709\u5b66\u4e60\u5230\u89c4\u5219\u7684\u6570\u636e\u5305\uff0c\u6839\u636e\u89c4\u5219\u6253\u4e0atunnel\u53f7\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u52a8\u6001\uff0c\u4e0d\u7528\u5199\u89c4\u5219\uff09\n\n### \u5176\u4f59\u6254\u7ed9table 22\u5904\u7406\novs-ofctl add-flow ovsbr  table=20, priority=0, actions=goto_table:22 \n\n## table 22\n### \u5339\u914din_port\u540e\u6253\u4e0atunnel\u53f7\uff0c\u5e76\u4ece\u5bf9\u5e94\u7684vtep port\u53d1\u51fa\uff08\u591a\u6761\uff09\novs-ofctl add-flow ovsbr  table=22, priority=1, in_port=${patch_ofport}, actions=set_tunnel:100,output:${vtepHost1_ofport} \n\n### \u5176\u4f59DROP\novs-ofctl add-flow ovsbr  table=22, priority=0, actions=drop \n\n# ns\nip netns add ns2\nip link add ns2-veth-in type veth peer name ns2-veth-out\nip link set ns2-veth-in netns ns2\nip link set ns2-veth-out up\nip netns exec ns2 ip link set lo up\nip netns exec ns2 ifconfig ns2-veth-in 192.168.1.2 netmask 255.255.255.0 up\nbrctl addif br1 ns2-veth-out", 
            "title": "ns - ns\uff08ovs-port\uff09"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm_4", 
            "text": "tcp: 6.89Gb/s\nudp:\n    client 4.72Gb/s\n    server 4.55Gb/s  \u73af\u5883 \u548c\u4e0a\u9762\u8fd9\u4e2a\u4e00\u6837\uff0c\u53ea\u662f\u4e0d\u7528# ns\u90e8\u5206", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_two_vxlan/#neutron", 
            "text": "vm -  bridge --veth  br-int --patch  br-tun -  vtep\uff0c\u5373openstack\u7684\u6027\u80fd\u6d4b\u8bd5", 
            "title": "Neutron\u6a21\u5f0f"
        }, 
        {
            "location": "/test/stress_two_vxlan/#kvm-kvm_5", 
            "text": "tcp: 8.52Gb/s\nudp:\n    client 4.48Gb/s\n    server 3.96Gb/s  \u73af\u5883 Host1:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# bridge\nbrctl addbr br1\nip link set br1 up\n\n# veth\nip link add veth-b type veth peer name veth-o\nip link set veth-b up\nip link set veth-o up\nbrctl addif br1 veth-b\n\n# br-int\novs-vsctl add-br br-int\novs-vsctl add-port br-int veth-o\novs-vsctl set port veth-o tag=1\n\n# patch\novs-vsctl add-port br-int patch-tun -- set interface patch-tun type=patch options:peer=patch-int\n\n# br-tun\novs-vsctl add-br br-tun\novs-ofctl del-flows br-tun\novs-vsctl add-port br-tun patch-int -- set interface patch-int type=patch options:peer=patch-tun\n\n# vtep\novs-vsctl add-port br-tun vtepHost2 -- set interface vtepHost2 type=vxlan options:remote_ip=10.246.247.90 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-int ofport`\nvtepHost2_ofport=`ovs-vsctl get interface vtepHost2 ofport`\n\n## table 0\novs-ofctl add-flow br-tun  table=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2 \novs-ofctl add-flow br-tun  table=0, priority=1, in_port=${vtepHost2_ofport}, actions=goto_table:4 \n\n## table 2\novs-ofctl add-flow br-tun  table=2, priority=0, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \novs-ofctl add-flow br-tun  table=2, priority=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n## table 4\novs-ofctl add-flow br-tun  table=4, priority=1, tun_id=0x3e9, actions=mod_vlan_vid:1, goto_table:10 \novs-ofctl add-flow br-tun  table=4, priority=0, actions=drop \n\n## table 10\novs-ofctl add-flow br-tun  table=10, priority=1, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0- NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport} \n\n## table 20\novs-ofctl add-flow br-tun  table=20, priority=0, actions=goto_table:22 \n\n## table 22\novs-ofctl add-flow br-tun  table=22, priority=1, dl_vlan=1, actions=strip_vlan,set_tunnel:0x3e9,output:${vtepHost2_ofport} \n\n\nHost2:\n# \u8bbe\u7f6eem1\u7684mtu\nip link set em1 mtu 1550\n\n# bridge\nbrctl addbr br1\nip link set br1 up\n\n# veth\nip link add veth-b type veth peer name veth-o\nip link set veth-b up\nip link set veth-o up\nbrctl addif br1 veth-b\n\n# br-int\novs-vsctl add-br br-int\novs-vsctl add-port br-int veth-o\novs-vsctl set port veth-o tag=1\n\n# patch\novs-vsctl add-port br-int patch-tun -- set interface patch-tun type=patch options:peer=patch-int\n\n# br-tun\novs-vsctl add-br br-tun\novs-ofctl del-flows br-tun\novs-vsctl add-port br-tun patch-int -- set interface patch-int type=patch options:peer=patch-tun\n\n# vtep\novs-vsctl add-port br-tun vtepHost1 -- set interface vtepHost1 type=vxlan options:remote_ip=10.246.247.89 options:ttl=64 options:in_key=flow options:out_key=flow\n\n# openflow\n## \u83b7\u5f97openflow\u7aef\u53e3\npatch_ofport=`ovs-vsctl get interface patch-int ofport`\nvtepHost1_ofport=`ovs-vsctl get interface vtepHost1 ofport`\n\n## table 0\novs-ofctl add-flow br-tun  table=0, priority=1, in_port=${patch_ofport}, actions=goto_table:2 \novs-ofctl add-flow br-tun  table=0, priority=1, in_port=${vtepHost1_ofport}, actions=goto_table:4 \n\n## table 2\novs-ofctl add-flow br-tun  table=2, priority=0, dl_dst=00:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:20 \novs-ofctl add-flow br-tun  table=2, priority=0, dl_dst=01:00:00:00:00:00/01:00:00:00:00:00, actions=goto_table:22 \n\n## table 4\novs-ofctl add-flow br-tun  table=4, priority=1, tun_id=0x3e9, actions=mod_vlan_vid:1, goto_table:10 \novs-ofctl add-flow br-tun  table=4, priority=0, actions=drop \n\n## table 10\novs-ofctl add-flow br-tun  table=10, priority=1, actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0- NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]- NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:${patch_ofport} \n\n## table 20\novs-ofctl add-flow br-tun  table=20, priority=0, actions=goto_table:22 \n\n## table 22\novs-ofctl add-flow br-tun  table=22, priority=1, dl_vlan=1, actions=strip_vlan,set_tunnel:0x3e9,output:${vtepHost1_ofport}", 
            "title": "kvm - kvm"
        }, 
        {
            "location": "/test/stress_summary/", 
            "text": "conntrack\u5f71\u54cd\n\n\n\n\n\u7531\u4e8eovs\u5f3a\u5236\u52a0\u8f7dconntrack\u6a21\u5757\uff0c\u56e0\u6b64\u9700\u8981\u5927\u91cfip\u548c\u7aef\u53e3\u624d\u80fd\u6d4b\u51fa\u6765\uff0c\u53ea\u80fd\u7b49\u5230\u4e0a\u7ebf\u4e86\u624d\u77e5\u9053\n\n\n\u6027\u80fd\u6bd4\u8f83", 
            "title": "2.5. \u7ed3\u8bba"
        }, 
        {
            "location": "/test/stress_summary/#conntrack", 
            "text": "\u7531\u4e8eovs\u5f3a\u5236\u52a0\u8f7dconntrack\u6a21\u5757\uff0c\u56e0\u6b64\u9700\u8981\u5927\u91cfip\u548c\u7aef\u53e3\u624d\u80fd\u6d4b\u51fa\u6765\uff0c\u53ea\u80fd\u7b49\u5230\u4e0a\u7ebf\u4e86\u624d\u77e5\u9053", 
            "title": "conntrack\u5f71\u54cd"
        }, 
        {
            "location": "/test/stress_summary/#_1", 
            "text": "", 
            "title": "\u6027\u80fd\u6bd4\u8f83"
        }, 
        {
            "location": "/appendix/doc/", 
            "text": "ovs\n\n\n\n\nhttp://blog.csdn.net/sqx2011/article/details/39344869\n\n\n\n\nopenflow\n\n\n\n\n\n\nhttps://www.ibm.com/developerworks/cn/cloud/library/1401_zhaoyi_openswitch/index.html\n\n\n\n\n\n\nhttp://www.rendoumi.com/open-vswitchzhong-ovs-ofctlde-xiang-xi-yong-fa/\n\n\n\n\n\n\novn\n\n\n\n\n\n\nhttp://www.sdnlab.com/18600.html\n\n\n\n\n\n\nhttp://blog.csdn.net/zhengmx100/article/details/71698641\n\n\n\n\n\n\nmanpage\n\n\n\n\novs-vsctl\u7684options\uff1aman ovs-vswitchd.conf.db\n\n\novs-ofctl\u914d\u7f6e\u6d41\u8868\u7684actions\uff1aman ovs-ofctl\n\n\nopenflow\u6d41\u8868\u5339\u914d\u53c2\u6570\uff1aman ovs-fields", 
            "title": "1. \u53c2\u8003\u8d44\u6599"
        }, 
        {
            "location": "/appendix/doc/#manpage", 
            "text": "ovs-vsctl\u7684options\uff1aman ovs-vswitchd.conf.db  ovs-ofctl\u914d\u7f6e\u6d41\u8868\u7684actions\uff1aman ovs-ofctl  openflow\u6d41\u8868\u5339\u914d\u53c2\u6570\uff1aman ovs-fields", 
            "title": "manpage"
        }, 
        {
            "location": "/appendix/traffic/", 
            "text": "\u5728ovs\u91cc\uff0c\u5bf9port\u53ea\u6709egress\u9650\u901f\uff0c\u5bf9interface\u53ea\u6709ingress\u9650\u901f\n\n\n\u53c2\u8003\uff1a\nhttp://openvswitch.org/support/dist-docs/ovs-vswitchd.conf.db.5.html\n\n\ningress_policing_rate\u5c31\u662f\u5e26\u5bbd\u5165\u53e3\u9650\u901f\uff0c\u8d85\u8fc7\u7684\u4e22\u5305\u5904\u7406\n\n\ningress_policing_burst \u5728ingress_policing_rate\u4e4b\u4e0a\u7684\u5165\u53e3\u7a81\u53d1\u6d41\u91cf\u9650\u5236\uff0c\u8be5\u503c\u6700\u5c11\u4e5f\u8981\u7b49\u4e8e\u8be5interface\u7684MTU\u503c\uff0c\u6700\u597d\u8bbe\u7f6e\u4e3aingress_policing_rate\u7684\n=10%\uff0c\u5efa\u8bae\u4e3a10%\uff08\u5bf9TCP\u5f88\u91cd\u8981\uff0cTCP\u9700\u8981\u5bf9\u4e22\u5305\u4f5c\u51fa\u53cd\u5e94\uff0c\u800c\u4e14\u8bbe\u7f6e\u4e3a10%\u540etcp\u6d41\u91cf\u7684\u4e0a\u9650\u624d\u4f1a\u66f4\u63a5\u8fd1ingress_policing_rate\u503c\uff09", 
            "title": "2. ovs\u6570\u636e\u6d41\u91cf\u53ca\u9650\u901f"
        }, 
        {
            "location": "/appendix/nxm/", 
            "text": "The OpenFlow 1.2 format, called OXM (OpenFlow  Extensible  Match),  was modeled  closely  on  an  extension  to OpenFlow 1.0 introduced in Open vSwitch 1.1 called NXM (Nicira Extended Match)\n\n\nman ovs-fields", 
            "title": "3. NXM"
        }, 
        {
            "location": "/appendix/neutron/", 
            "text": "https://github.com/yeasy/openstack_understand_Neutron\n\n\npdf\u6587\u6863\u5df2\u653e\u5165\u672c\u7ad9\u9644\u4ef6\u4e2d\uff0c\n\u70b9\u51fb\u4e0b\u8f7d\n\n\n\n\n\n\nhttp://blog.sina.com.cn/s/blog_6de3aa8a0102uy3t.html", 
            "title": "4. Neutron\u6d41\u8868\u5206\u6790"
        }, 
        {
            "location": "/appendix/mac_mask/", 
            "text": "ovs\u5b98\u65b9\u89e3\u91ca\n\n\n\n\nman ovs-fields\b\n\n\nOpen vSwitch 1.8 and later support arbitrary masks for source and/or destination. Earlier versions only support masking the destination with the following masks:\n\n       01:00:00:00:00:00\n              Match  only  the  multicast  bit.  Thus,  dl_dst=01:00:00:00:00:00/01:00:00:00:00:00  matches  all  multicast  (including  broadcast)  Ethernet  packets,  and\n              dl_dst=00:00:00:00:00:00/01:00:00:00:00:00 matches all unicast Ethernet packets.\n\n       fe:ff:ff:ff:ff:ff\n              Match all bits except the multicast bit. This is probably not useful.\n\n       ff:ff:ff:ff:ff:ff\n              Exact match (equivalent to omitting the mask).\n\n       00:00:00:00:00:00\n              Wildcard all bits (equivalent to dl_dst=*).\n\n\n\n\n\u5355\u64ad\u3001\u591a\u64ad\u3001\u5e7f\u64ad\n\n\n\n\n\n\n\n\n\u5355\u64ad: \u6700\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u6700\u540e\u4e00\u4e2abit\u4e3a0\n\n\nxxxxxxx0:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx\n\n\n\u53ef\u4ee5\u7528\n00:00:00:00:00:00/01:00:00:00:00:00\n\u6765\u8868\u793a\n\n\n\n\n\n\n\u591a\u64ad: \u6700\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u6700\u540e\u4e00\u4e2abit\u4e3a1\uff0c\u5f53\u6240\u6709bit\u90fd\u4e3a1\u5c31\u662f\u5e7f\u64ad\uff0c\u5373\u591a\u64ad\u5305\u62ec\u5e7f\u64ad\uff0c\u5c31\u50cf\u6b63\u65b9\u5f62\u5c5e\u4e8e\u957f\u65b9\u5f62\uff0c\u4f46\u6b63\u65b9\u5f62\u662f\u72ec\u7279\u7684\u957f\u65b9\u5f62\uff0c\u591a\u64ad\u5c31\u50cf\u662f\u957f\u65b9\u5f62\uff0c\u5e7f\u64ad\u5c31\u50cf\u662f\u6b63\u65b9\u5f62\n\n\nxxxxxxx1:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx\n\n\n\u53ef\u4ee5\u7528\n01:00:00:00:00:00/01:00:00:00:00:00\n\u6765\u8868\u793a\uff0c\u4f46\u4e0d\u662f\u53ea\u80fd\u8fd9\u4e48\u8868\u793a\uff0c\u53ea\u8981\u63a9\u7801\u91cc\u4e3a0\u5bf9\u5e94\u5230\u7684mac\u53ef\u4ee5\u4e3a\u4efb\u4f55\u6570\uff0c\u5373\u4e5f\u53ef\u4ee5\u5199\u6210\na1:bb:cc:dd:ee:ff/01:00:00:00:00:00\n\uff0c\u6216\u8005\n11:1b:cc:dd:ee:ff/11:10:08:00:00:00\n\uff0c\u90fd\u662f\u53ef\u4ee5\u7684\n\n\n\n\n\n\n\u5e7f\u64ad: \u6240\u6709bit\u5747\u4e3a1\uff0c\u56e0\u6b64\u5c31\u662f\nff:ff:ff:ff:ff:ff/ff:ff:ff:ff:ff:ff\n\n\n\n\n\n\n\u5982\u679c\u8981\u5339\u914d\u5177\u4f53\u7684mac\u5730\u5740\uff0c\u5c31\u628a\u63a9\u7801\u5199\u6210\nff:ff:ff:ff:ff:ff\n\u5373\u53ef\uff08\u5982\u679c\u4e0d\u5199\u63a9\u7801\uff0c\u9ed8\u8ba4\u5c31\u662f\u5168f\uff09\n\n\n\u6ce8\u610f\uff1a\u5982\u679c\u60f3\u53ea\u5339\u914d\u591a\u64ad\uff0c\u4f46\u4e0d\u5305\u542b\u5e7f\u64ad\uff0c\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7\u63a9\u7801\u505a\u5230\uff0c\u53ea\u80fd\u5728\u5199\u6761\u76ee\u89c4\u5219\u65f6\u5019\u5148\u5339\u914d\u5e7f\u64ad\uff0c\u518d\u5339\u914d\u591a\u64ad\n\n\n\u63a9\u7801\u5339\u914d\u7b97\u6cd5\u8be6\u89e3\n\n\n\n\n\u4f8b\u5982\n11:1b:cc:dd:ee:ff/11:10:08:00:00:00\n\u8868\u793a\n\n\n\u5730\u5740\n11:1b:cc:dd:ee:ff\n -\n \u4e8c\u8fdb\u5236\u4e3a\n00010001:00011011:11001100:11011101:11101110:11111111\n\n\n\u63a9\u7801\n11:10:08:00:00:00\n -\n \u4e8c\u8fdb\u5236\u4e3a\n00010001:00010000:00001000:00000000:00000000:00000000\n\n\n\u63a9\u7801\u4e2d\u4e3a1\u7684\uff0c\u5bf9\u5e94\u5230\u5730\u5740\u7684bit\u4e0d\u53d8\uff0c\u63a9\u7801\u4e2d\u4e3a0\u7684\uff0c\u5bf9\u5e94\u5230\u5730\u5740\u7684bit\u53ef\u4ee5\u4e3a1\u4e5f\u53ef\u4e3a0\uff0c\u548cip/netmask\u7684\u7b97\u6cd5\u662f\u7c7b\u4f3c\u7684\uff0c\u56e0\u6b64\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u53ef\u4ee5\u8868\u793a\u7684\u8303\u56f4\u662f\uff1a\n\n\n\u6700\u5c0f\uff1a\n00010001:00010000:00001000:00000000:00000000:00000000\n\n\n\u6700\u5927\uff1a\n11111111:11111111:11111111:11111111:11111111:11111111\n\n\n\u8f6c\u6362\u621016\u8fdb\u5236\uff0c\u5219\u662f\uff1a\n\n\n\u4ece\n11:10:08:00:00:00\n\u5230\nff:ff:ff:ff:ff:ff\n\n\n\n\nWarning\n\n\n\u8fd9\u4e2a\u4f8b\u5b50\u7b97\u51fa\u6765\u7684\u6700\u5c0f\u5730\u5740\u521a\u597d\u548c\u63a9\u7801\u4e00\u6837\uff0c\u8fd9\u53ea\u662f\u4e2a\u5de7\u5408", 
            "title": "5. MAC\u5730\u5740\u63a9\u7801"
        }, 
        {
            "location": "/appendix/mac_mask/#ovs", 
            "text": "man ovs-fields\b  Open vSwitch 1.8 and later support arbitrary masks for source and/or destination. Earlier versions only support masking the destination with the following masks:\n\n       01:00:00:00:00:00\n              Match  only  the  multicast  bit.  Thus,  dl_dst=01:00:00:00:00:00/01:00:00:00:00:00  matches  all  multicast  (including  broadcast)  Ethernet  packets,  and\n              dl_dst=00:00:00:00:00:00/01:00:00:00:00:00 matches all unicast Ethernet packets.\n\n       fe:ff:ff:ff:ff:ff\n              Match all bits except the multicast bit. This is probably not useful.\n\n       ff:ff:ff:ff:ff:ff\n              Exact match (equivalent to omitting the mask).\n\n       00:00:00:00:00:00\n              Wildcard all bits (equivalent to dl_dst=*).", 
            "title": "ovs\u5b98\u65b9\u89e3\u91ca"
        }, 
        {
            "location": "/appendix/mac_mask/#_1", 
            "text": "\u5355\u64ad: \u6700\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u6700\u540e\u4e00\u4e2abit\u4e3a0  xxxxxxx0:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx  \u53ef\u4ee5\u7528 00:00:00:00:00:00/01:00:00:00:00:00 \u6765\u8868\u793a    \u591a\u64ad: \u6700\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u6700\u540e\u4e00\u4e2abit\u4e3a1\uff0c\u5f53\u6240\u6709bit\u90fd\u4e3a1\u5c31\u662f\u5e7f\u64ad\uff0c\u5373\u591a\u64ad\u5305\u62ec\u5e7f\u64ad\uff0c\u5c31\u50cf\u6b63\u65b9\u5f62\u5c5e\u4e8e\u957f\u65b9\u5f62\uff0c\u4f46\u6b63\u65b9\u5f62\u662f\u72ec\u7279\u7684\u957f\u65b9\u5f62\uff0c\u591a\u64ad\u5c31\u50cf\u662f\u957f\u65b9\u5f62\uff0c\u5e7f\u64ad\u5c31\u50cf\u662f\u6b63\u65b9\u5f62  xxxxxxx1:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx:xxxxxxxx  \u53ef\u4ee5\u7528 01:00:00:00:00:00/01:00:00:00:00:00 \u6765\u8868\u793a\uff0c\u4f46\u4e0d\u662f\u53ea\u80fd\u8fd9\u4e48\u8868\u793a\uff0c\u53ea\u8981\u63a9\u7801\u91cc\u4e3a0\u5bf9\u5e94\u5230\u7684mac\u53ef\u4ee5\u4e3a\u4efb\u4f55\u6570\uff0c\u5373\u4e5f\u53ef\u4ee5\u5199\u6210 a1:bb:cc:dd:ee:ff/01:00:00:00:00:00 \uff0c\u6216\u8005 11:1b:cc:dd:ee:ff/11:10:08:00:00:00 \uff0c\u90fd\u662f\u53ef\u4ee5\u7684    \u5e7f\u64ad: \u6240\u6709bit\u5747\u4e3a1\uff0c\u56e0\u6b64\u5c31\u662f ff:ff:ff:ff:ff:ff/ff:ff:ff:ff:ff:ff    \u5982\u679c\u8981\u5339\u914d\u5177\u4f53\u7684mac\u5730\u5740\uff0c\u5c31\u628a\u63a9\u7801\u5199\u6210 ff:ff:ff:ff:ff:ff \u5373\u53ef\uff08\u5982\u679c\u4e0d\u5199\u63a9\u7801\uff0c\u9ed8\u8ba4\u5c31\u662f\u5168f\uff09  \u6ce8\u610f\uff1a\u5982\u679c\u60f3\u53ea\u5339\u914d\u591a\u64ad\uff0c\u4f46\u4e0d\u5305\u542b\u5e7f\u64ad\uff0c\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7\u63a9\u7801\u505a\u5230\uff0c\u53ea\u80fd\u5728\u5199\u6761\u76ee\u89c4\u5219\u65f6\u5019\u5148\u5339\u914d\u5e7f\u64ad\uff0c\u518d\u5339\u914d\u591a\u64ad", 
            "title": "\u5355\u64ad\u3001\u591a\u64ad\u3001\u5e7f\u64ad"
        }, 
        {
            "location": "/appendix/mac_mask/#_2", 
            "text": "\u4f8b\u5982 11:1b:cc:dd:ee:ff/11:10:08:00:00:00 \u8868\u793a  \u5730\u5740 11:1b:cc:dd:ee:ff  -  \u4e8c\u8fdb\u5236\u4e3a 00010001:00011011:11001100:11011101:11101110:11111111  \u63a9\u7801 11:10:08:00:00:00  -  \u4e8c\u8fdb\u5236\u4e3a 00010001:00010000:00001000:00000000:00000000:00000000  \u63a9\u7801\u4e2d\u4e3a1\u7684\uff0c\u5bf9\u5e94\u5230\u5730\u5740\u7684bit\u4e0d\u53d8\uff0c\u63a9\u7801\u4e2d\u4e3a0\u7684\uff0c\u5bf9\u5e94\u5230\u5730\u5740\u7684bit\u53ef\u4ee5\u4e3a1\u4e5f\u53ef\u4e3a0\uff0c\u548cip/netmask\u7684\u7b97\u6cd5\u662f\u7c7b\u4f3c\u7684\uff0c\u56e0\u6b64\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u53ef\u4ee5\u8868\u793a\u7684\u8303\u56f4\u662f\uff1a  \u6700\u5c0f\uff1a 00010001:00010000:00001000:00000000:00000000:00000000  \u6700\u5927\uff1a 11111111:11111111:11111111:11111111:11111111:11111111  \u8f6c\u6362\u621016\u8fdb\u5236\uff0c\u5219\u662f\uff1a  \u4ece 11:10:08:00:00:00 \u5230 ff:ff:ff:ff:ff:ff   Warning  \u8fd9\u4e2a\u4f8b\u5b50\u7b97\u51fa\u6765\u7684\u6700\u5c0f\u5730\u5740\u521a\u597d\u548c\u63a9\u7801\u4e00\u6837\uff0c\u8fd9\u53ea\u662f\u4e2a\u5de7\u5408", 
            "title": "\u63a9\u7801\u5339\u914d\u7b97\u6cd5\u8be6\u89e3"
        }, 
        {
            "location": "/appendix/conntrack/", 
            "text": "lsmod | grep -i conntrack\nnf_conntrack_ipv6      18894  1\nnf_conntrack_ipv4      19108  1\nnf_defrag_ipv4         12729  1 nf_conntrack_ipv4\nnf_defrag_ipv6         35104  2 openvswitch,nf_conntrack_ipv6\nnf_conntrack          111302  6 openvswitch,nf_nat,nf_nat_ipv4,nf_nat_ipv6,nf_conntrack_ipv4,nf_conntrack_ipv6\n\n\n lsmod | grep -i nat\nnf_nat_ipv6            14131  1 openvswitch\nnf_nat_ipv4            14115  1 openvswitch\nnf_nat                 26147  3 openvswitch,nf_nat_ipv4,nf_nat_ipv6\nnf_conntrack          111302  6 openvswitch,nf_nat,nf_nat_ipv4,nf_nat_ipv6,nf_conntrack_ipv4,nf_conntrack_ipv6\n\n\n lsmod | grep -i openvswitch\nopenvswitch           106775  4 vport_vxlan\nnf_nat_ipv6            14131  1 openvswitch\nnf_nat_ipv4            14115  1 openvswitch\nnf_defrag_ipv6         35104  2 openvswitch,nf_conntrack_ipv6\nnf_nat                 26147  3 openvswitch,nf_nat_ipv4,nf_nat_ipv6\nnf_conntrack          111302  6 openvswitch,nf_nat,nf_nat_ipv4,nf_nat_ipv6,nf_conntrack_ipv4,nf_conntrack_ipv6\nlibcrc32c              12644  3 xfs,bnx2x,openvswitch", 
            "title": "6. ovs\u6a21\u5757\u4f1a\u8c03\u7528conntrack"
        }, 
        {
            "location": "/contact/", 
            "text": "E-mail\u5730\u5740:", 
            "title": "\u4e03. \u8054\u7cfb\u65b9\u5f0f"
        }
    ]
}